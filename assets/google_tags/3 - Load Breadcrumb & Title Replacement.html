<script>
  // Combined Script: Dynamic Page Title Replacement and Breadcrumb Update - 08/17/2025 06:09 PM CDT
  function getPageTitle(path) {
    var pagePath = path.replace(/^\/+|\/+$/g, '').split('/').pop() || 'Home';
    pagePath = pagePath.replace(/_/g, ' ').replace(/-/g, ' ').replace(/\b\w/g, function(l) { return l.toUpperCase(); });
    return pagePath;
  }

  function replaceTextInNode(node, search, replacement) {
    var count = 0;
    if (node.nodeType === 3) {
      var matches = node.nodeValue.match(search) || [];
      count += matches.length;
      node.nodeValue = node.nodeValue.replace(search, replacement);
    } else if (node.nodeType === 1 && node.tagName !== 'SCRIPT' && node.tagName !== 'STYLE') {
      for (var i = 0; i < node.childNodes.length; i++) {
        count += replaceTextInNode(node.childNodes[i], search, replacement);
      }
    }
    return count;
  }

  function updateBreadcrumb(path, directory, pageTitle) {
    var breadcrumb = document.querySelector('[aria-label="Breadcrumb"]');
    if (breadcrumb) {
      if (!directory) {
        var link = breadcrumb.querySelector('.directory-link');
        if (link) {
          var parent = link.parentElement;
          var elements = parent.querySelectorAll('svg, .directory-link');
          if (elements.length > 0) elements[0].style.display = 'none';
        }
      }
      var items = [
        '<a href="/" class="hover:text-neutral-900 focus:outline-none focus:ring-2 focus:ring-primary-500">Home</a>'
      ];
      if (directory) {
        // Corrected typo: "pcp" to "pcb" and retained "30a" replacement
        directory = directory.replace(/\b(pcb)\b/gi, 'PCB').replace(/\b(30a)\b/gi, '30A');
        items.push('<a href="/' + directory + '" class="hover:text-neutral-900 focus:outline-none focus:ring-2 focus:ring-primary-500 directory-link">' + directory + '</a>');
      }
      items.push('<span class="text-neutral-500" aria-current="page">' + pageTitle + '</span>');
      var separator = '<svg class="w-4 h-4 text-neutral-400 flex-shrink-0" style="width: 1rem; height: 1rem;" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/></path></svg>';
      var breadcrumbHTML = items.reduce(function(acc, curr, index) {
        if (index > 0) {
          return acc + separator + curr;
        }
        return acc + curr;
      }, '');
      breadcrumb.innerHTML = breadcrumbHTML;
      console.log('Step 2: Breadcrumb Updated');
      var script = document.createElement('script');
      script.type = 'application/ld+json';
      script.textContent = JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          { "@type": "ListItem", "position": 1, "name": "Home", "item": window.location.origin + "/" },
          { "@type": "ListItem", "position": 2, "name": directory, "item": window.location.origin + "/" + path[0] },
          { "@type": "ListItem", "position": 3, "name": pageTitle, "item": window.location.href }
        ].filter(function(item) { return item.name; })
      });
      document.head.appendChild(script);
    }
  }

  // Shared URL parsing
  var path = window.location.pathname.split('/').filter(function(item) { return item; });
  var directory = path.length > 0 ? path[0].charAt(0).toUpperCase() + path[0].slice(1).toLowerCase() : '';
  // Replace "pcb" with "PCB" and "30a" with "30A" (case-insensitive)
  directory = directory.replace(/\b(pcb)\b/gi, 'PCB').replace(/\b(30a)\b/gi, '30A');
  var pageTitle = getPageTitle(window.location.pathname);
  // Title replacement
  var search = /%Page Title%/g;
  var totalReplacements = replaceTextInNode(document.body, search, pageTitle);
  console.log('Step 1: Replaced Title ' + totalReplacements + ' time(s)');
  // Breadcrumb update
  updateBreadcrumb(path, directory, pageTitle);
</script>