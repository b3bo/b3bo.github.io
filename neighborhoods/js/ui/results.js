/**
 * @file ui/results.js
 * @description Results list rendering and sorting for neighborhood sidebar.
 * @copyright 2025 Kimberly Bauman, P.A. All rights reserved.
 */
import{eventBus as e,Events as t}from"../core/eventBus.js";export function formatAmenitiesWithSelection(e){if(!e||0===e.length)return"No amenities listed";const t=window.filterState?.amenities||new Set;return e.map(e=>t.has(e)?`<strong>${e}</strong>`:e).join(", ")+"."}export function listingLabelForType(e){const t=(e||"").toLowerCase();return t.includes("townhome")?"Active T/H Listings":t.includes("condo")?"Active Condo Listings":t.includes("home")?"Active Home Listings":"Active Listings"}export function hasActiveFilters(){const e=window.filterState||{},t=(window.neighborhoods||[]).length;return(window.filteredNeighborhoods||[]).length<t||!!window.searchQuery||!!e.propertyType||!!(e.areas&&e.areas.size>0)||!!(e.amenities&&e.amenities.size>0)||e.priceMin>0||e.priceMax<41||e.bedsMin>1||e.bathsMin>1}export function renderResults(){const n=document.getElementById("neighborhoodList"),r=document.getElementById("resultsCount");if(!n)return;const i=window.filteredNeighborhoods||[],o=window.sortOrder||"listings-desc",a=[...i].sort((e,t)=>{const n=e.stats?.medianPrice||e.stats?.avgPrice||0,r=t.stats?.medianPrice||t.stats?.avgPrice||0,i=e.stats?.listingCount||0,a=t.stats?.listingCount||0;switch(o){case"name-asc":default:return e.name.localeCompare(t.name);case"name-desc":return t.name.localeCompare(e.name);case"price-asc":return n-r;case"price-desc":return r-n;case"listings-desc":return a-i}});if(r){const e=a.length,t=1===e?" Community":" Communities",n=hasActiveFilters()?' <button id="clear-filters" class="ml-2 px-3 py-1 text-sm font-medium rounded-lg border border-neutral-300 dark:border-dark-border bg-white dark:bg-dark-bg-elevated text-neutral-700 dark:text-dark-text-primary hover:bg-brand-100 dark:hover:bg-brand-dark/20 hover:text-brand-700 dark:hover:text-brand-dark transition-colors">Clear</button>':"",i=null!==window.lastDisplayedCount?window.lastDisplayedCount:e;if(r.innerHTML=`<span class="count-number">${i}</span>${t}${n}`,window.animateCount&&window.animateCount(r,e),hasActiveFilters()){const e=document.getElementById("clear-filters");e&&e.addEventListener("click",e=>{e.stopPropagation(),window.clearAllFilters&&window.clearAllFilters()})}}const s=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M");n.innerHTML=a.map(e=>`\n        <button type="button" class="neighborhood-item w-full text-left bg-white dark:bg-dark-bg-elevated px-4 py-3 rounded-xl border border-neutral-200 dark:border-dark-border cursor-pointer overflow-hidden transition-colors hover:bg-brand-100 dark:hover:bg-brand-dark/20 active:bg-brand-200 dark:active:bg-brand-dark/30"\n             data-name="${e.name}" data-type="${e.propertyType}">\n            <div class="flex justify-between items-start gap-2 mb-1">\n                <h3 class="text-base font-semibold text-neutral-800 dark:text-dark-text-primary break-words">${e.name}</h3>\n                <span class="text-sm font-semibold text-neutral-800 dark:text-dark-text-primary whitespace-nowrap">${s(e.stats?.medianPrice||e.stats?.avgPrice||0)}</span>\n            </div>\n            <div class="text-xs text-neutral-600 dark:text-dark-text-secondary mb-3">${e.stats?.listingCount||0} ${listingLabelForType(e.propertyType)}</div>\n            <div class="text-xs text-neutral-600 dark:text-dark-text-secondary leading-relaxed break-words">${formatAmenitiesWithSelection(e.amenities||[])}</div>\n        </button>\n    `).join(""),n.querySelectorAll(".neighborhood-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.name,n=e.dataset.type,r=(window.filteredNeighborhoods||[]).find(e=>e.name===t&&e.propertyType===n);if(r&&window.map){"undefined"!=typeof gtag&&gtag("event","select_neighborhood",{neighborhood_name:r.name,listing_count:r.stats?.listingCount||0,price:s(r.stats?.medianPrice||r.stats?.avgPrice||0)}),window.smoothFlyTo&&window.smoothFlyTo(r.position);const e=(window.markers||[]).find(e=>e.neighborhood.name===t&&e.neighborhood.propertyType===n);if(e){const t=window.map.getCenter(),n=new google.maps.LatLng(r.position),i=google.maps.geometry.spherical.computeDistanceBetween(t,n);setTimeout(()=>{google.maps.event.trigger(e.marker,"click")},i<2e3?450:2200)}}})}),e.emit(t.RESULTS_RENDERED,{count:a.length})}"undefined"!=typeof window&&(window.renderResults=renderResults,window.formatAmenitiesWithSelection=formatAmenitiesWithSelection,window.listingLabelForType=listingLabelForType,window.hasActiveFilters=hasActiveFilters);