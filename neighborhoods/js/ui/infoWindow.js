/**
 * @file ui/infoWindow.js
 * @description Info window content templates for Google Maps markers.
 * @copyright 2025 Kimberly Bauman, P.A. All rights reserved.
 */
import{eventBus as e,Events as t}from"../core/eventBus.js";export function showAreaInfoWindowContent(e,t,r){const n=t.stats||{},o=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M"),d=(t.neighborhoods||[]).slice(0,10).map(e=>e.name).join(", "),a=`\n        <div class="info-window p-2 sm:p-3 max-w-sm bg-white dark:bg-dark-bg-elevated">\n            <h3 class="text-base sm:text-lg font-semibold text-neutral-800 dark:text-dark-text-primary mb-2 text-center">${t.name}</h3>\n            <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                    <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary">${n.listingCount||0}</div>\n                    <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Active Listings</div>\n                </div>\n                <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                    <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary">${o(n.medianPrice||0)}</div>\n                    <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Median Price</div>\n                </div>\n            </div>\n            <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                    <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary">$${(n.avgPricePerSqFt||0).toLocaleString()}</div>\n                    <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg $/Sq Ft</div>\n                </div>\n                <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                    <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary">${n.avgDom||0}</div>\n                    <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg DOM</div>\n                </div>\n            </div>\n            <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 p-2 sm:p-3 rounded-lg border border-neutral-200 dark:border-dark-border mb-2 sm:mb-3">\n                <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-1">Top Communities</div>\n                <div class="communities-scroll text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">${d}</div>\n            </div>\n            <hr class="divider mb-2 sm:mb-3">\n            <div class="pt-2 sm:pt-3 flex items-center gap-1.5 sm:gap-2">\n                ${function(e){const t=(window.filteredNeighborhoods||[]).length>1,r=t?'<button id="nav-prev" onclick="window.navigateNeighborhood(-1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Previous Community"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button>':"",n=t?'<button id="nav-next" onclick="window.navigateNeighborhood(1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Next Community"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></button>':"";if(window.isSingleMode)return r+'<a href="'+("localhost"===window.location.hostname?window.location.origin:"https://neighborhoods.truesouthcoastalhomes.com")+"?marker="+e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-")+'" target="_blank" class="flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors" title="Open '+e.name+' in Neighborhood Finder">Neighborhood Finder&trade; <svg style="display:inline;width:1.1em;height:1.1em;vertical-align:middle;margin-left:2px" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg></a>'+n;{const t=(window.areaPresets?.presets||[]).find(t=>t.name===e.name);return r+'<a href="https://www.truesouthcoastalhomes.com/property-search/results/?searchtype=3#listtype_1/'+(t?.listingsParam||"area_"+encodeURIComponent(e.name)+"/")+'" target="_blank" class="flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors" onclick="event.stopPropagation();" title="View all '+e.name+' listings">Matching Listings</a>'+n}}(t)}\n            </div>\n        </div>\n    `;r.setContent(a),r.open(window.map,e),google.maps.event.addListenerOnce(r,"domready",()=>{const e=document.querySelector(".communities-scroll");e&&e.scrollHeight>e.clientHeight+4&&e.classList.add("has-overflow")})}export function showInfoWindowContent(r,n,o,d=!0){if(n.isAreaMarker)return showAreaInfoWindowContent(r,n,o);d&&o===window.infoWindow&&(window.currentNeighborhood=n);const a=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M"),i=n.stats||{},s=a(i.medianPrice||i.avgPrice||0),l=i.avgPricePerSqFt||(i.avgSqft>0?Math.round((i.avgPrice||0)/i.avgSqft):0),c=function(e){const t=(e||"").toLowerCase();return t.includes("townhome")?"Active T/H Listings":t.includes("condo")?"Active Condo Listings":t.includes("home")?"Active Home Listings":"Active Listings"}(n.propertyType),g=window.filterState&&window.filterState.amenities?window.filterState.amenities:new Set,m=function(e){const t=(e.propertyType||"homes").toLowerCase(),r=window.filterState||{},n=window.PRICE_STEPS||[],o=r.bedsMin||1,d=r.bathsMin||1,a=r.priceMin>0?n[r.priceMin]:null,i=r.priceMax<41?n[r.priceMax]:null,s=o>1?`beds_${o}/`:"",l=d>1?`baths_${d}/`:"",c=a?`lprice_${a}/`:"",g=i&&i<35e6?`uprice_${i}/`:"";let m="";m=t.includes("townhome")?"listtypedescrip_attached%20single%20unit/":t.includes("condo")?"listtypedescrip_condominium/":t.includes("lot")||t.includes("land")||t.includes("vacant")?"":"listtypedescrip_detached%20single%20family/";let x="listtype_1";(t.includes("lot")||t.includes("land")||t.includes("vacant"))&&(x="listtype_4");const b=`#${x}/${c}${g}${s}${l}${m}`;let p;return p=e.mlsSubdivisions&&e.mlsSubdivisions.length>0?`subdivision=${e.mlsSubdivisions.map(e=>e.replace(/ /g,"+")).join(",")}`:`subdivision=${e.name.replace(/ /g,"+")}`,`https://www.truesouthcoastalhomes.com/property-search/results/?searchtype=3&${p}${b}`}(n),x=(window.filteredNeighborhoods||[]).length>1,b=`\n        <div class="info-window p-2 sm:p-3 max-w-sm bg-white dark:bg-dark-bg-elevated" style="cursor: pointer;" tabindex="-1">\n            <div class="flex items-center justify-center gap-2 mb-2">\n                <h3 class="text-base sm:text-lg font-semibold text-neutral-800 dark:text-dark-text-primary">${n.name}</h3>\n                ${n.urlSlug?`\n                <a href="https://www.truesouthcoastalhomes.com${n.urlSlug}"\n                   target="_blank"\n                   class="text-brand-500 dark:text-brand-dark hover:text-brand-600 dark:hover:text-brand-dark-hover transition-colors focus-ring rounded"\n                   onclick="event.stopPropagation();"\n                   title="${n.name} ${n.propertyType} for Sale">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>\n                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>\n                    </svg>\n                </a>\n                `:""}\n            </div>\n            <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                    <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">${i.listingCount||0}</div>\n                    <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">${c}</div>\n                </div>\n                <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                    <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">${s}</div>\n                    <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Med List Price</div>\n                </div>\n            </div>\n            <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                    <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">$${l.toLocaleString()}</div>\n                    <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg $/Sq Ft</div>\n                </div>\n                <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                    <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">${i.avgDom||0}</div>\n                    <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg DOM</div>\n                </div>\n            </div>\n            ${(n.amenities||[]).length>0?`\n            <div class="mb-2 sm:mb-3">\n                <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 p-2 sm:p-3 rounded-lg border border-neutral-200 dark:border-dark-border">\n                    <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-1">Amenities</div>\n                    <div class="amenities-scroll text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary leading-tight">${((e=[])=>e.map(e=>{const t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return g.has(e)?`<strong>${t}</strong>`:t}).join(", ")+".")(n.amenities||[])}</div>\n                </div>\n            </div>\n            `:""}\n            <hr class="divider mb-2 sm:mb-3">\n            <div class="pt-2 sm:pt-3 flex items-center gap-1.5 sm:gap-2">\n                ${x?'\n                <button id="nav-prev" onclick="window.navigateNeighborhood(-1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Previous Community">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>\n                </button>\n                ':""}\n                ${function(e,t){const r=e.stats||{};if(window.isSingleMode){const t=window.toSlug?window.toSlug(e.name):e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-"),r=e.propertyType?"&propertyType="+encodeURIComponent(e.propertyType):"";return'<a href="'+("localhost"===window.location.hostname?window.location.origin:"https://neighborhoods.truesouthcoastalhomes.com")+"?marker="+t+r+'" target="_blank" class="flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors" title="Open '+e.name+' in Neighborhood Finder">Neighborhood Finder&trade; <svg style="display:inline;width:1.1em;height:1.1em;vertical-align:middle;margin-left:2px" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg></a>'}return t?'<a href="'+t+"\" target=\"_blank\" class=\"flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors\" onclick=\"event.stopPropagation(); if(typeof gtag!=='undefined')gtag('event','view_listings',{neighborhood_name:'"+e.name+"',listing_count:"+(r.listingCount||0)+",property_type:'"+e.propertyType+'\'});" title="View all '+e.name+" "+e.propertyType+' for sale">Matching Listings</a>':'<button class="flex-1 bg-neutral-300 dark:bg-dark-bg-elevated-2 text-neutral-500 dark:text-dark-text-secondary py-2.5 px-4 rounded-lg font-medium opacity-50 cursor-not-allowed" disabled title="MLS listings coming soon for '+e.name+'">Coming Soon!</button>'}(n,m)}\n                ${x?'\n                <button id="nav-next" onclick="window.navigateNeighborhood(1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Next Community">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>\n                </button>\n                ':""}\n            </div>\n        </div>\n    `;o.setContent(b),o.open(window.map,r),e.emit(t.INFO_WINDOW_OPENED,{neighborhood:n})}"undefined"!=typeof window&&(window.showInfoWindowContent=showInfoWindowContent,window.showAreaInfoWindowContent=showAreaInfoWindowContent);