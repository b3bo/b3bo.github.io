/**
 * @file keyboard/index.js
 * @description WCAG-compliant keyboard navigation and focus management.
 * @copyright 2025 Kimberly Bauman, P.A. All rights reserved.
 */
import{eventBus as e,Events as t}from"../core/eventBus.js";export function getFocusableElements(e){return Array.from(e.querySelectorAll('button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex="0"]')).filter(e=>null!==e.offsetParent&&"hidden"!==getComputedStyle(e).visibility&&!e.closest(".translate-x-full"))}export function handleTabTrap(e,t){const n=document.getElementById("drawer-toggle");if(!t||!n||!n.checked)return;const o=getFocusableElements(t);if(0===o.length)return void e.preventDefault();e.preventDefault();const r=document.activeElement;let l,i=o.indexOf(r);-1===i&&(i=e.shiftKey?0:o.length-1),l=e.shiftKey?0===i?o.length-1:i-1:i===o.length-1?0:i+1,o[l].focus()}export function handleEscapeKey(){const e=document.getElementById("search-dropdown"),t=document.getElementById("sort-menu"),n=document.getElementById("main-menu");e&&e.classList.add("hidden"),t&&t.classList.add("hidden"),window.infoWindow&&window.infoWindow.getMap()&&window.infoWindow.close();const o=document.querySelector(".sliding-panel:not(.translate-x-full)");if(o)return o.classList.add("translate-x-full"),void(n&&(n.style.removeProperty("display"),n.scrollTop=0,window.lastFocusedMenuItem&&setTimeout(()=>window.lastFocusedMenuItem.focus(),50)));const r=document.getElementById("drawer-toggle");if(r&&r.checked){r.checked=!1,r.dispatchEvent(new Event("change",{bubbles:!0})),window.lastFocusedMenuItem=null;const e=document.getElementById("sidebar-toggle-tab");e&&setTimeout(()=>e.focus(),50)}}export function handleMenuArrowNav(e){const t=document.activeElement?.closest(".menu-item");if(!t)return!1;e.preventDefault();const n=Array.from(document.querySelectorAll(".menu-item")),o=n.indexOf(t);let r;return r="ArrowDown"===e.key?(o+1)%n.length:0===o?n.length-1:o-1,n[r].focus(),!0}export function handleSortArrowNav(e){const t=document.activeElement?.closest(".sort-option");if(!t)return!1;e.preventDefault();const n=Array.from(document.querySelectorAll(".sort-option")),o=n.indexOf(t);let r;return r="ArrowDown"===e.key?(o+1)%n.length:0===o?n.length-1:o-1,n[r].focus(),!0}export function handleControlGroupHorizontalNav(e){const t=document.activeElement?.closest('[role="group"]');if(!t)return!1;e.preventDefault();const n=Array.from(t.querySelectorAll("button:not([disabled])")),o=n.indexOf(document.activeElement);if(-1===o)return!1;let r;return r="ArrowRight"===e.key?(o+1)%n.length:0===o?n.length-1:o-1,n[r].focus(),!0}export function handleControlGroupVerticalNav(e){const t=document.activeElement?.closest('[role="group"]');if(!t)return!1;e.preventDefault();const n=Array.from(t.querySelectorAll("button:not([disabled])")),o=document.activeElement,r=o.getBoundingClientRect(),l=r.left+r.width/2;let i=n.filter(t=>{if(t===o)return!1;const n=t.getBoundingClientRect();return"ArrowDown"===e.key?n.top>r.bottom-5:n.bottom<r.top+5});return i.length>0&&(i.sort((t,n)=>{const o=t.getBoundingClientRect(),r=n.getBoundingClientRect(),i=o.left+o.width/2,d=r.left+r.width/2,a=Math.abs(i-l),c=Math.abs(d-l),u="ArrowDown"===e.key?o.top:-o.bottom,s="ArrowDown"===e.key?r.top:-r.bottom;return Math.abs(u-s)>10?u-s:a-c}),i[0].focus()),!0}export function handleSortOptionSelect(e){const t=document.activeElement?.closest(".sort-option");if(!t)return!1;e.preventDefault();const n=t.querySelector('input[type="radio"]');return n&&(n.checked=!0,n.dispatchEvent(new Event("change",{bubbles:!0}))),!0}export function handleInfoWindowArrowNav(e){window.infoWindow&&window.infoWindow.getMap()&&window.navigateNeighborhood&&("ArrowLeft"===e.key?(e.preventDefault(),window.navigateNeighborhood(-1)):"ArrowRight"===e.key&&(e.preventDefault(),window.navigateNeighborhood(1)))}"undefined"!=typeof window&&(window.getFocusableElements=getFocusableElements,window.handleTabTrap=handleTabTrap,window.handleEscapeKey=handleEscapeKey);