/**
 * @file core/events.js
 * @description Centralized event delegation for performance and memory efficiency.
 * @copyright 2025 Kimberly Bauman, P.A. All rights reserved.
 */
import{eventBus as e,Events as t}from"./eventBus.js";const n=new Map,o=new Map,i=new Map;export function onClick(e,t){return n.has(e)||n.set(e,new Set),n.get(e).add(t),()=>n.get(e)?.delete(t)}export function onKeydown(e,t){return o.has(e)||o.set(e,new Set),o.get(e).add(t),()=>o.get(e)?.delete(t)}export function onInput(e,t){return i.has(e)||i.set(e,new Set),i.get(e).add(t),()=>i.get(e)?.delete(t)}function s(e,t){return"document"===t?document.documentElement:e.closest(t)}function a(e,t){for(const[n,o]of e){const e=s(t.target,n);if(e)for(const i of o)try{if(i(t,e),t.defaultPrevented)return}catch(e){console.error(`Error in ${t.type} handler for "${n}":`,e)}}}export function initEventDelegation(){document.addEventListener("click",e=>{a(n,e)},{capture:!1}),document.addEventListener("keydown",e=>{a(o,e)},{capture:!1}),document.addEventListener("input",e=>{a(i,e)},{capture:!1}),console.log("Event delegation initialized")}export function registerCommonHandlers(){onClick(".menu-item",(n,o)=>{const i=o.dataset.panel;if(!i)return;const s=document.getElementById(i),a=document.getElementById("main-menu");s&&(window.lastFocusedMenuItem=o,s.classList.remove("translate-x-full"),a&&(a.style.display="none"),setTimeout(()=>{const e=s.querySelector('button, input, [tabindex="0"]');e?.focus()},100),e.emit(t.PANEL_OPENED,{panelId:i}))}),onKeydown(".menu-item",(e,t)=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())}),onClick('.sliding-panel button[onclick*="translate-x-full"]',(n,o)=>{const i=o.closest(".sliding-panel"),s=document.getElementById("main-menu");i&&(i.classList.add("translate-x-full"),s&&(s.style.removeProperty("display"),s.scrollTop=0,window.lastFocusedMenuItem&&setTimeout(()=>window.lastFocusedMenuItem.focus(),50)),e.emit(t.PANEL_CLOSED,{panelId:i.id}))}),onClick(".sort-option",(e,t)=>{const n=t.querySelector('input[type="radio"]');n&&!n.checked&&(n.checked=!0,n.dispatchEvent(new Event("change",{bubbles:!0})))}),onClick("#homes-btn, #condos-btn",(n,o)=>{const i=o.classList.contains("filter-btn-active");o.classList.toggle("filter-btn-active",!i),o.classList.toggle("filter-btn-inactive",i),window.applyFilters&&window.applyFilters(),e.emit(t.FILTERS_CHANGED,{type:"propertyType"})}),onClick(".amenity-tag",(n,o)=>{const i=o.classList.contains("filter-btn-active");o.classList.toggle("filter-btn-active",!i),o.classList.toggle("filter-btn-inactive",i);const s=o.dataset.opposite;if(s&&!i){const e=document.getElementById(s);e&&(e.classList.remove("filter-btn-active"),e.classList.add("filter-btn-inactive"))}window.applyFilters&&window.applyFilters(),e.emit(t.FILTERS_CHANGED,{type:"amenity"})}),onClick(".area-tag",(n,o)=>{const i=o.classList.contains("filter-btn-active");o.classList.toggle("filter-btn-active",!i),o.classList.toggle("filter-btn-inactive",i);const s=o.dataset.zipcode;s&&(!i&&window.showCustomBoundary?window.showCustomBoundary(s):i&&window.hideCustomBoundary&&window.hideCustomBoundary(s)),window.applyFilters&&window.applyFilters(),e.emit(t.FILTERS_CHANGED,{type:"area"})}),onClick("#search-results .search-result",(e,t)=>{window.handleSearchResultClick&&window.handleSearchResultClick(t)}),onKeydown("document",e=>{"Escape"===e.key&&window.handleEscapeKey&&window.handleEscapeKey()}),onKeydown("document",e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||window.infoWindow?.getMap()&&window.navigateNeighborhood&&(e.preventDefault(),window.navigateNeighborhood("ArrowLeft"===e.key?-1:1))}),onInput("#price-min, #price-max, #beds-slider, #baths-slider",(e,t)=>{window.applyFilters&&(clearTimeout(window._filterDebounce),window._filterDebounce=setTimeout(()=>window.applyFilters(),50))})}export function getHandlerCounts(){return{click:Array.from(n.values()).reduce((e,t)=>e+t.size,0),keydown:Array.from(o.values()).reduce((e,t)=>e+t.size,0),input:Array.from(i.values()).reduce((e,t)=>e+t.size,0)}}"undefined"!=typeof window&&(window._eventDelegation={onClick:onClick,onKeydown:onKeydown,onInput:onInput,getHandlerCounts:getHandlerCounts});