/**
 * @file map/boundaries.js
 * @description Lazy loading and caching of GeoJSON zip code boundaries.
 * @copyright 2025 Kimberly Bauman, P.A. All rights reserved.
 */
import{CONFIG as o}from"../config.js";import{eventBus as e,Events as t}from"../core/eventBus.js";const r=new Map,n=new Set,a=new Map;export async function loadBoundary(e){if(r.has(e))return r.get(e);if(a.has(e))return a.get(e);const t=(async()=>{try{const t=await fetch(function(e){return`${o.data.geojsonPath||"./neighborhoods/jsons/"}${e}.geojson`}(e));if(!t.ok)throw new Error(`Failed to load boundary for ${e}`);const n=await t.json();return r.set(e,n),n}catch(o){return console.warn(`Boundary load failed for ${e}:`,o.message),null}finally{a.delete(e)}})();return a.set(e,t),t}function i(){const o=document.documentElement.classList.contains("dark")?"#5ba3ab":"#4c8f96";return{strokeColor:o,strokeWeight:1.5,strokeOpacity:.35,fillColor:o,fillOpacity:.15,clickable:!1}}export async function showBoundary(o){const r=window.map;if(!r)return!1;if(n.has(o))return!0;n.add(o);const a=await loadBoundary(o);return a?(r.data.addGeoJson(a,{idPropertyName:"ZCTA5CE20"}),r.data.setStyle(o=>{const e=o.getProperty("ZCTA5CE20")||o.getProperty("ZCTA5CE10");return n.has(e)?i():{visible:!1}}),e.emit(t.BOUNDARY_SHOWN,{zipCode:o}),!0):(n.delete(o),!1)}export function hideBoundary(o){const r=window.map;r&&n.has(o)&&(n.delete(o),r.data.forEach(e=>{(e.getProperty("ZCTA5CE20")||e.getProperty("ZCTA5CE10"))===o&&r.data.remove(e)}),e.emit(t.BOUNDARY_HIDDEN,{zipCode:o}))}export function hideAllBoundaries(){[...n].forEach(hideBoundary)}export function getVisibleBoundaries(){return new Set(n)}export function isBoundaryVisible(o){return n.has(o)}export function refreshBoundaryStyles(){const o=window.map;o&&o.data.setStyle(o=>{const e=o.getProperty("ZCTA5CE20")||o.getProperty("ZCTA5CE10");return n.has(e)?i():{visible:!1}})}export function preloadBoundaries(o){o.forEach(loadBoundary)}export function clearBoundaryCache(){r.clear()}"undefined"!=typeof window&&(window.customBoundaries=n,window.showCustomBoundary=showBoundary,window.hideCustomBoundary=hideBoundary,window.refreshBoundaryStyles=refreshBoundaryStyles,window.hideAllBoundaries=hideAllBoundaries);