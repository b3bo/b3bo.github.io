/**
 * @file filters/index.js
 * @description Filter coordination, state management, and apply logic.
 * @copyright 2025 Kimberly Bauman, P.A. All rights reserved.
 */
import{eventBus as e,Events as t}from"../core/eventBus.js";import{formatSliderPrice as i,parseRange as n}from"../utils.js";export function initFilterState(){window.filterState=window.filterState||{propertyType:null,areas:new Set,amenities:new Set,priceMin:0,priceMax:41,bedsMin:1,bathsMin:1}}export function updatePriceSlider(e,t,n){if(!e||!t)return;const a=window.PRICE_STEPS||[],o=document.getElementById("price-display"),d=document.getElementById("price-fill");let s=parseInt(e.value),l=parseInt(t.value);if(isNaN(s)&&(s=0),isNaN(l)&&(l=0),s>l&&(n?.target===t?(e.value=l,s=l):(t.value=s,l=s)),window.filterState.priceMin=s,window.filterState.priceMax=l,o)if(0===s&&0===l)o.textContent="$250K - $35M+";else{const e=a[s]||a[0],t=a[l]||a[a.length-1];o.textContent=`${i(e)} - ${i(t)}${41===l?"+":""}`}if(d){const e=s/41,t=l/41;0===s?(d.style.left="0",d.style.width=100*t+"%"):(d.style.left=100*e+"%",d.style.width=100*(t-e)+"%")}applyFilters()}export function updateBedsSlider(){const e=document.getElementById("beds-min"),t=document.getElementById("beds-display"),i=document.getElementById("beds-fill");if(!e)return;const n=parseInt(e.value)||1;if(window.filterState.bedsMin=n,t&&(t.textContent=1===n?"Any":n>=6?"6+":`${n}+`),i){const e=(n-1)/5*100;i.style.width=`${e}%`}applyFilters()}export function updateBathsSlider(){const e=document.getElementById("baths-min"),t=document.getElementById("baths-display"),i=document.getElementById("baths-fill");if(!e)return;const n=parseInt(e.value)||1;if(window.filterState.bathsMin=n,t&&(t.textContent=1===n?"Any":n>=6?"6+":`${n}+`),i){const e=(n-1)/5*100;i.style.width=`${e}%`}applyFilters()}export function applyFilters(){const i=window.PRICE_STEPS||[],a=document.getElementById("btn-homes"),o=document.getElementById("btn-condos"),d=!!a&&a.classList.contains("active"),s=!!o&&o.classList.contains("active"),l=window.filterState.areas,r=window.filterState.amenities,c=window.filterState.priceMin||0,w=window.filterState.priceMax||41,m=window.filterState.bedsMin||1,u=window.filterState.bathsMin||1;let y=0===c?0:i[c]||0,p=w>=41?Number.MAX_SAFE_INTEGER:i[w]||Number.MAX_SAFE_INTEGER;window.filteredNeighborhoods=(window.neighborhoods||[]).filter(e=>{let t=!0;if(d||s){t=!1;const i=(e.propertyType||"").toLowerCase();!d||"homes"!==i&&"townhomes"!==i||(t=!0),s&&"condos"===i&&(t=!0)}let i=!0;l.size>0&&(i=l.has(e.zipCode)||l.has(e.area)||l.has(e.subArea));let a=!0;r.size>0&&(a=[...r].every(t=>e.amenities&&e.amenities.includes(t)));let o=!0;const c=e.stats||{};if(c.priceRange&&"N/A"!==c.priceRange){const e=n(c.priceRange);e&&(o=p>=e.min&&y<=e.max)}let w=!0;if(m>1){const e=void 0!==c.maxBeds?parseFloat(c.maxBeds):null;null===e||isNaN(e)||(w=e>=m)}let f=!0;if(u>1){const e=void 0!==c.maxBaths?parseFloat(c.maxBaths):null;null===e||isNaN(e)||(f=e>=u)}return t&&i&&a&&o&&w&&f}),window.renderResults&&window.renderResults(),window.addMarkers&&window.addMarkers(),!(window.activeAreaSlug&&window.infoWindow?.getMap())&&window.fitBoundsToNeighborhoods&&window.fitBoundsToNeighborhoods(),e.emit(t.FILTERS_APPLIED,{count:window.filteredNeighborhoods.length,filters:{propertyType:d?"homes":s?"condos":null,areas:[...l],amenities:[...r],priceMin:y,priceMax:p,bedsMin:m,bathsMin:u}})}export function clearAllFilters(){window.filterState={propertyType:null,areas:new Set,amenities:new Set,priceMin:0,priceMax:0,bedsMin:1,bathsMin:1},window.searchQuery="";const i=document.getElementById("search-input");i&&(i.value="");const n=document.getElementById("price-min"),a=document.getElementById("price-max");n&&(n.value=0),a&&(a.value=0);const o=document.getElementById("beds-min"),d=document.getElementById("baths-min");o&&(o.value=1),d&&(d.value=1);const s=document.getElementById("btn-homes"),l=document.getElementById("btn-condos");s&&s.classList.remove("active"),l&&l.classList.remove("active"),document.querySelectorAll("[data-filter-type]").forEach(e=>{e.classList.remove("bg-brand-600","text-white"),e.classList.add("bg-white","text-neutral-700")}),document.querySelectorAll(".area-tag").forEach(e=>{e.classList.remove("selected")}),window.areaMarkers&&window.areaMarkers.forEach((e,t)=>{window.hideAreaMarker&&window.hideAreaMarker(t)}),document.querySelectorAll("input[data-amenity]").forEach(e=>{e.checked=!1}),document.querySelectorAll(".amenity-tag").forEach(e=>{e.classList.remove("selected")}),document.querySelectorAll(".price-preset").forEach(e=>{e.classList.remove("selected")}),window.customBoundaries&&window.hideCustomBoundary&&[...window.customBoundaries].forEach(e=>{window.hideCustomBoundary(e)}),window.filteredNeighborhoods=[...window.neighborhoods||[]],window.renderResults&&window.renderResults(),window.addMarkers&&window.addMarkers();const r=document.getElementById("price-display");r&&(r.textContent="$250K - $35M+");const c=document.getElementById("beds-display"),w=document.getElementById("baths-display");c&&(c.textContent="Any"),w&&(w.textContent="Any");const m=document.getElementById("price-fill"),u=document.getElementById("beds-fill"),y=document.getElementById("baths-fill");m&&(m.style.left="0",m.style.width="0"),u&&(u.style.width="0%"),y&&(y.style.width="0%"),"undefined"!=typeof gtag&&gtag("event","clear_filters"),e.emit(t.FILTERS_CLEARED)}export function handleAreaTagClick(e){e.classList.toggle("selected");const t=e.getAttribute("data-zipcode"),i=e.getAttribute("data-subarea"),n=e.classList.contains("selected");t&&(n?(window.filterState.areas.add(t),window.showCustomBoundary&&window.showCustomBoundary(t)):(window.filterState.areas.delete(t),window.hideCustomBoundary&&window.hideCustomBoundary(t)),"undefined"!=typeof gtag&&gtag("event","filter_area",{area:t,action:n?"selected":"deselected"})),i&&(n?window.filterState.areas.add(i):window.filterState.areas.delete(i),"undefined"!=typeof gtag&&gtag("event","filter_subarea",{subarea:i,action:n?"selected":"deselected"})),applyFilters()}export function handleAmenityTagClick(e){const t=e.getAttribute("data-amenity");if(!t)return;if("Short-Term"===t){const e=document.querySelector('.amenity-tag[data-amenity="No Short-Term"]');e&&e.classList.contains("selected")&&(e.classList.remove("selected"),window.filterState.amenities.delete("No Short-Term"))}else if("No Short-Term"===t){const e=document.querySelector('.amenity-tag[data-amenity="Short-Term"]');e&&e.classList.contains("selected")&&(e.classList.remove("selected"),window.filterState.amenities.delete("Short-Term"))}e.classList.toggle("selected");const i=e.classList.contains("selected");i?window.filterState.amenities.add(t):window.filterState.amenities.delete(t),"undefined"!=typeof gtag&&gtag("event","filter_amenity",{amenity:t,action:i?"selected":"deselected"}),applyFilters()}export function handlePropertyTypeClick(e){e.classList.toggle("active"),applyFilters()}"undefined"!=typeof window&&(window.applyFilters=applyFilters,window.clearAllFilters=clearAllFilters,window.updateBedsSlider=updateBedsSlider,window.updateBathsSlider=updateBathsSlider,window.handleAreaTagClick=handleAreaTagClick,window.handleAmenityTagClick=handleAmenityTagClick,window.handlePropertyTypeClick=handlePropertyTypeClick,window.initFilterState=initFilterState,initFilterState());