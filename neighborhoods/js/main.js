/**
 * @file main.js
 * @description Main application logic for Neighborhood Finderâ„¢
 * @copyright 2025 Kimberly Bauman, P.A. All rights reserved.
 *
 * This file was extracted from inline scripts in index.html
 * for better maintainability and caching.
 */
function e(){const e=window.location.search.replace(/&amp;/g,"&");return new URLSearchParams(e)}function t(){if(window.appInitialized)return;window.appInitialized=!0;const t=e(),o="single"===t.get("mode"),n=(t.get("neighborhood")||t.get("marker"))?.toLowerCase();window.isSingleMode=o;const i=window.self!==window.top,r=t.get("infoWindowSize");if(window.useMiniInfoWindow="mini"===r,o){console.log("Single mode active:",n);const e=document.getElementById("single-mode-overlay");e&&(e.style.display="flex",e.style.opacity="1",console.log("Single mode: overlay shown (early, in initApp)"))}if(i){const e=document.querySelector(".disclaimer-bar"),t=document.getElementById("map-layout");e&&(e.style.display="none"),t&&(t.style.height="100dvh")}if(!o&&window.innerWidth>=768){const e=document.getElementById("drawer-toggle");e&&(e.checked=!0)}const a=window.neighborhoods||[];window.filteredNeighborhoods,window.sortOrder,window.formatPrice;const s=document.querySelectorAll(".menu-item"),d=document.querySelectorAll(".panel-back-btn"),l=document.getElementById("main-menu");s.forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-panel"),t=document.getElementById(e+"-panel");if(t){document.querySelectorAll(".sliding-panel").forEach(e=>{e.id!==t.id&&e.classList.add("translate-x-full")}),l&&(l.style.display="none"),t.classList.remove("translate-x-full");const e=t.querySelector(".panel-back-btn");e&&setTimeout(()=>e.focus(),100)}}),e.addEventListener("keydown",function(e){const t=document.getElementById("drawer-toggle");t&&t.checked&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),window.lastFocusedMenuItem=this,this.click()))})}),d.forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation();const t=this.getAttribute("data-close-panel"),o=document.getElementById(t+"-panel");if(o){o.classList.add("translate-x-full");const e=document.getElementById("search-dropdown"),t=document.getElementById("sort-menu");e&&e.classList.add("hidden"),t&&t.classList.add("hidden"),l&&(l.style.removeProperty("display"),l.scrollTop=0,window.lastFocusedMenuItem&&setTimeout(()=>window.lastFocusedMenuItem.focus(),50))}})});const c=document.getElementById("sidebar-toggle-tab");if(c){c.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())});const e=()=>{const e=document.getElementById("drawer-toggle");c.tabIndex=e&&e.checked?-1:0};document.getElementById("drawer-toggle")?.addEventListener("change",e),e()}const w=document.getElementById("theme-toggle");w&&w.addEventListener("click",function(){document.documentElement.classList.toggle("dark");const t=document.documentElement.classList.contains("dark");if(window.map&&"undefined"!=typeof google){const o=window.map.getCenter(),n=window.map.getZoom(),i=(window.markers,"false"===e().controls);function r(){const e=document.querySelector(".gm-style-iw-chr");e&&e.remove()}if(window.map=new google.maps.Map(document.getElementById("map"),{zoom:n,center:o,mapId:"92b2f4ea8b2fce54a50ed2e9",colorScheme:t?"DARK":"LIGHT",disableDefaultUI:i,mapTypeControl:!i,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!i,fullscreenControl:!i,zoomControl:!i,clickableIcons:!1}),window.infoWindow=new google.maps.InfoWindow({maxWidth:320}),window.hoverInfoWindow=new google.maps.InfoWindow({maxWidth:320}),window.infoWindow.addListener("domready",r),window.hoverInfoWindow.addListener("domready",r),window.addMarkers(),window.customBoundaries&&window.customBoundaries.size>0){const a=new Set(window.customBoundaries);window.customBoundaries.clear(),a.forEach(e=>{window.showCustomBoundary(e)})}}"undefined"!=typeof gtag&&gtag("event","theme_toggle",{theme:t?"dark":"light"})});const g=document.getElementById("search-button"),m=document.getElementById("search-dropdown"),u=document.getElementById("search-input"),p=document.getElementById("sort-button"),h=document.getElementById("sort-menu");function f(e,t){if(!e||!t)return;const o=t.getBoundingClientRect(),n=window.visualViewport,i=n?n.width:window.innerWidth,r=n?n.offsetLeft:0,a=n?n.offsetTop:0;let s=r+o.left+o.width/2-140;s+280>r+i-12&&(s=r+i-280-12),s<r+12&&(s=r+12),e.style.position="fixed",e.style.top=a+o.bottom+10+"px",e.style.left=s+"px",e.style.zIndex="2147483647"}m&&document.body.appendChild(m),h&&document.body.appendChild(h),g&&m&&g.addEventListener("click",function(e){if(e.stopPropagation(),h&&h.classList.add("hidden"),m.classList.toggle("hidden"),!m.classList.contains("hidden")){f(m,g),u&&(u.value="",u.focus()),function(){const e=document.getElementById("search-results"),t=window.neighborhoods||[];if(!e||!t.length)return;const o=[...t].sort((e,t)=>(t.stats?.listingCount||0)-(e.stats?.listingCount||0)).slice(0,5);e.innerHTML=`\n                    <div class="px-4 py-2 text-xs font-medium text-neutral-400 dark:text-dark-text-secondary uppercase">Most Listings</div>\n                    ${o.map(e=>`\n                        <button class="search-result w-full text-left px-4 py-2 text-sm hover:bg-brand-100 dark:hover:bg-brand-dark/20 transition-colors cursor-pointer" data-name="${e.name}" data-type="${e.propertyType}">\n                            ${e.name} - ${e.propertyType}\n                        </button>\n                    `).join("")}\n                `}();const e=document.getElementById("search-results");e&&(e.scrollHeight>e.clientHeight+4?e.classList.add("has-overflow"):e.classList.remove("has-overflow"))}}),p&&h&&(p.addEventListener("click",function(e){if(e.stopPropagation(),m&&m.classList.add("hidden"),h.classList.toggle("hidden"),!h.classList.contains("hidden")){f(h,p);const e=h.querySelector('input[type="radio"]:checked'),t=e?e.closest(".sort-option"):h.querySelector(".sort-option");t&&setTimeout(()=>t.focus(),50)}}),p.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())})),document.addEventListener("click",function(e){!m||m.contains(e.target)||e.target===g||g.contains(e.target)||m.classList.add("hidden"),!h||h.contains(e.target)||e.target===p||p.contains(e.target)||h.classList.add("hidden")});const v=document.getElementById("sidebar"),y=document.getElementById("drawer-toggle");document.addEventListener("keydown",function(e){const t="INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName;if("Tab"===e.key&&y&&y.checked){if(m&&!m.classList.contains("hidden"))return;if(h&&!h.classList.contains("hidden")){h.classList.add("hidden");const e=document.getElementById("sort-button");e&&(e.setAttribute("aria-expanded","false"),e.removeAttribute("aria-activedescendant"))}!function(e){if(!v||!y||!y.checked)return;const t=(o=v,Array.from(o.querySelectorAll('button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex="0"]')).filter(e=>null!==e.offsetParent&&"hidden"!==getComputedStyle(e).visibility&&!e.closest(".translate-x-full")));var o;if(0===t.length)return void e.preventDefault();e.preventDefault();const n=document.activeElement;let i,r=t.indexOf(n);-1===r&&(r=e.shiftKey?0:t.length-1),i=e.shiftKey?0===r?t.length-1:r-1:r===t.length-1?0:r+1,t[i].focus()}(e)}else{if("Escape"===e.key){m&&m.classList.add("hidden"),h&&h.classList.add("hidden"),window.infoWindow&&window.infoWindow.getMap()&&window.infoWindow.close();const e=document.querySelector(".sliding-panel:not(.translate-x-full)");if(e)return e.classList.add("translate-x-full"),void(l&&(l.style.removeProperty("display"),l.scrollTop=0,window.lastFocusedMenuItem&&setTimeout(()=>window.lastFocusedMenuItem.focus(),50)));const t=document.getElementById("drawer-toggle");if(t&&t.checked){t.checked=!1,t.dispatchEvent(new Event("change",{bubbles:!0})),window.lastFocusedMenuItem=null;const e=document.getElementById("sidebar-toggle-tab");e&&setTimeout(()=>e.focus(),50)}}if(!t&&("ArrowDown"===e.key||"ArrowUp"===e.key)){const t=document.activeElement?.closest(".menu-item");if(t){e.preventDefault();const o=Array.from(document.querySelectorAll(".menu-item")),n=o.indexOf(t);let i;return i="ArrowDown"===e.key?(n+1)%o.length:0===n?o.length-1:n-1,void o[i].focus()}const o=document.activeElement?.closest(".sort-option");if(o){e.preventDefault();const t=Array.from(document.querySelectorAll(".sort-option")),n=t.indexOf(o);let i;return i="ArrowDown"===e.key?(n+1)%t.length:0===n?t.length-1:n-1,void t[i].focus()}}if(!t&&("Enter"===e.key||" "===e.key)){const t=document.activeElement?.closest(".sort-option");if(t){e.preventDefault();const o=t.querySelector('input[type="radio"]');o&&(o.checked=!0,o.dispatchEvent(new Event("change",{bubbles:!0})))}}if(!t&&("ArrowLeft"===e.key||"ArrowRight"===e.key)){const t=document.activeElement?.closest('[role="group"]');if(t){e.preventDefault();const o=Array.from(t.querySelectorAll("button:not([disabled])")),n=o.indexOf(document.activeElement);if(-1!==n){let t;t="ArrowRight"===e.key?(n+1)%o.length:0===n?o.length-1:n-1,o[t].focus()}return}}if(!t&&("ArrowUp"===e.key||"ArrowDown"===e.key)){const t=document.activeElement?.closest('[role="group"]');if(t){e.preventDefault();const o=Array.from(t.querySelectorAll("button:not([disabled])")),n=document.activeElement,i=n.getBoundingClientRect(),r=i.left+i.width/2;let a=o.filter(t=>{if(t===n)return!1;const o=t.getBoundingClientRect();return"ArrowDown"===e.key?o.top>i.bottom-5:o.bottom<i.top+5});return void(a.length>0&&(a.sort((t,o)=>{const n=t.getBoundingClientRect(),i=o.getBoundingClientRect(),a=n.left+n.width/2,s=i.left+i.width/2,d=Math.abs(a-r),l=Math.abs(s-r),c="ArrowDown"===e.key?n.top:-n.bottom,w="ArrowDown"===e.key?i.top:-i.bottom;return Math.abs(c-w)>10?c-w:d-l}),a[0].focus()))}}!t&&window.infoWindow&&window.infoWindow.getMap()&&("ArrowLeft"===e.key?(e.preventDefault(),window.navigateNeighborhood(-1)):"ArrowRight"===e.key&&(e.preventDefault(),window.navigateNeighborhood(1)))}}),u&&u.addEventListener("keydown",function(e){("Enter"===e.key||"Escape"===e.key)&&(e.preventDefault(),m.classList.add("hidden"),u.blur())}),["resize","orientationchange"].forEach(e=>{window.addEventListener(e,()=>{m&&!m.classList.contains("hidden")&&f(m,g),h&&!h.classList.contains("hidden")&&f(h,p)})}),window.addEventListener("scroll",()=>{m&&!m.classList.contains("hidden")&&f(m,g),h&&!h.classList.contains("hidden")&&f(h,p)},!0),window.visualViewport&&["resize","scroll"].forEach(e=>{window.visualViewport.addEventListener(e,()=>{m&&!m.classList.contains("hidden")&&f(m,g),h&&!h.classList.contains("hidden")&&f(h,p)})}),u&&u.addEventListener("blur",()=>{setTimeout(()=>{window.scrollTo(0,0),document.documentElement.scrollLeft=0,document.body.scrollLeft=0},100)});let k=null,b=null;function x(){const e=window.filterState||{},t=(window.neighborhoods||[]).length;return(window.filteredNeighborhoods||[]).length<t||!!window.searchQuery||!!e.propertyType||!!(e.areas&&e.areas.size>0)||!!(e.amenities&&e.amenities.size>0)||e.priceMin>0||e.priceMax<41||e.bedsMin>1||e.bathsMin>1}function M(){const e=document.getElementById("neighborhoodList"),t=document.getElementById("resultsCount");if(!e)return;const o=window.filteredNeighborhoods||[],n=window.sortOrder||"listings-desc",i=[...o].sort((e,t)=>{const o=e.stats?.medianPrice||e.stats?.avgPrice||0,i=t.stats?.medianPrice||t.stats?.avgPrice||0,r=e.stats?.listingCount||0,a=t.stats?.listingCount||0;switch(n){case"name-asc":default:return e.name.localeCompare(t.name);case"name-desc":return t.name.localeCompare(e.name);case"price-asc":return o-i;case"price-desc":return i-o;case"listings-desc":return a-r}});if(t){const e=i.length,o=1===e?"Neighborhood":"Neighborhoods",n=x()?' <button id="clear-filters" class="ml-2 px-2 py-0.5 text-xs font-medium rounded-md border border-neutral-300 dark:border-dark-border bg-white dark:bg-dark-bg-elevated text-neutral-600 dark:text-dark-text-secondary hover:bg-brand-100 dark:hover:bg-brand-dark/20 hover:text-brand-700 dark:hover:text-brand-dark transition-colors">Clear</button>':"";t.innerHTML=`<span class="count-number">${null!==k?k:e}</span>`;const r=document.getElementById("resultsLabel");if(r&&(r.innerHTML=`${o}${n}`),function(e,t,o=700){b&&(cancelAnimationFrame(b),b=null);const n=e.querySelector(".count-number"),i=n?parseInt(n.textContent,10):null,r=null===i||isNaN(i)?null!==k?k:t:i,a=t-r;if(0===a||null===k)return k=t,void(n&&(n.textContent=t));const s=performance.now();b=requestAnimationFrame(function e(i){const d=i-s,l=Math.min(d/o,1),c=1-Math.pow(1-l,3),w=Math.round(r+a*c);n&&(n.textContent=w),l<1?b=requestAnimationFrame(e):(b=null,k=t)})}(t,e),x()){const e=document.getElementById("clear-filters");e&&e.addEventListener("click",e=>{e.stopPropagation(),function(){window.filterState={propertyType:null,areas:new Set,amenities:new Set,priceMin:0,priceMax:0,bedsMin:1,bathsMin:1},window.searchQuery="";const e=document.getElementById("search-input");e&&(e.value="");const t=document.getElementById("price-min"),o=document.getElementById("price-max");t&&(t.value=0),o&&(o.value=0);const n=document.getElementById("beds-slider"),i=document.getElementById("baths-slider");n&&(n.value=1),i&&(i.value=1),document.querySelectorAll("[data-filter-type]").forEach(e=>{e.classList.remove("bg-brand-600","text-white"),e.classList.add("bg-white","text-neutral-700")}),document.querySelectorAll(".area-tag").forEach(e=>{e.classList.remove("selected")}),window.areaMarkers&&window.areaMarkers.forEach((e,t)=>{window.hideAreaMarker&&window.hideAreaMarker(t)}),document.querySelectorAll("input[data-amenity]").forEach(e=>{e.checked=!1}),document.querySelectorAll(".amenity-tag").forEach(e=>{e.classList.remove("selected")}),window.customBoundaries&&window.hideCustomBoundary&&[...window.customBoundaries].forEach(e=>{window.hideCustomBoundary(e)}),window.filteredNeighborhoods=[...window.neighborhoods||[]],M(),window.addMarkers&&window.addMarkers();const r=document.getElementById("price-display");r&&(r.textContent="$250K - $35M+");const a=document.getElementById("price-fill");a&&(a.style.left="0",a.style.width="0");const s=document.getElementById("beds-display"),d=document.getElementById("baths-display");s&&(s.textContent="1+"),d&&(d.textContent="1+"),"undefined"!=typeof gtag&&gtag("event","clear_filters")}()})}}const r=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M");e.innerHTML=i.map(e=>`\n                    <button type="button" class="neighborhood-item w-full text-left bg-white dark:bg-dark-bg-elevated px-4 py-3 rounded-xl border border-neutral-200 dark:border-dark-border cursor-pointer overflow-hidden transition-colors hover:bg-brand-100 dark:hover:bg-brand-dark/20 active:bg-brand-200 dark:active:bg-brand-dark/30"\n                         data-name="${e.name}" data-type="${e.propertyType}">\n                        <div class="flex justify-between items-start gap-2 mb-1">\n                            <h3 class="text-base font-semibold text-neutral-800 dark:text-dark-text-primary break-words">${e.name}</h3>\n                            <span class="text-sm font-semibold text-neutral-800 dark:text-dark-text-primary whitespace-nowrap">${r(e.stats?.medianPrice||e.stats?.avgPrice||0)}</span>\n                        </div>\n                        <div class="text-xs text-neutral-600 dark:text-dark-text-secondary mb-3">${e.stats?.listingCount||0} ${e.propertyType,"Active"}</div>\n                        <div class="text-xs text-neutral-600 dark:text-dark-text-secondary leading-relaxed break-words">${function(e){if(!e||0===e.length)return"No amenities listed";const t=window.filterState?.amenities||new Set;return e.map(e=>t.has(e)?`<strong>${e}</strong>`:e).join(", ")+"."}(e.amenities||[])}</div>\n                    </button>\n                `).join(""),e.querySelectorAll(".neighborhood-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.name,o=e.dataset.type,n=(window.filteredNeighborhoods||[]).find(e=>e.name===t&&e.propertyType===o);if(n&&window.map){"undefined"!=typeof gtag&&gtag("event","select_neighborhood",{neighborhood_name:n.name,listing_count:n.stats?.listingCount||0,price:r(n.stats?.medianPrice||n.stats?.avgPrice||0)}),window.smoothFlyTo(n.position,window.map.getZoom());const e=(window.markers||[]).find(e=>e.neighborhood.name===t&&e.neighborhood.propertyType===o);if(e){const t=window.map.getCenter(),o=new google.maps.LatLng(n.position),i=google.maps.geometry.spherical.computeDistanceBetween(t,o);setTimeout(()=>{google.maps.event.trigger(e.marker,"click");const t=document.getElementById("drawer-toggle");t&&(t.checked=!1)},i<2e3?450:2200)}}})})}window.PRICE_STEPS=window.PRICE_STEPS||[25e4,3e5,35e4,4e5,45e4,5e5,55e4,6e5,65e4,7e5,75e4,8e5,85e4,9e5,95e4,1e6,125e4,15e5,175e4,2e6,225e4,25e5,275e4,3e6,325e4,35e5,375e4,4e6,425e4,45e5,475e4,5e6,6e6,7e6,8e6,9e6,1e7,15e6,2e7,25e6,3e7,35e6];const L=window.PRICE_STEPS;window.filterState={propertyType:null,areas:new Set,amenities:new Set,priceMin:0,priceMax:41};const S=document.getElementById("price-min"),C=document.getElementById("price-max"),I=document.getElementById("price-display"),T=document.getElementById("price-fill");function E(e){return e>=1e6?"$"+(e/1e6).toFixed(e%1e6==0?0:1)+"M":"$"+(e/1e3).toFixed(0)+"K"}function A(){if(!S||!C)return;let e=parseInt(S.value)||0,t=parseInt(C.value)||41;if(e>t&&(this===C?(S.value=t,e=t):(C.value=e,t=e)),window.filterState.priceMin=e,window.filterState.priceMax=t,I)if(0===e&&0===t)I.textContent="$250K - $35M+";else{const o=L[e]||L[0],n=L[t]||L[L.length-1];I.textContent=`${E(o)} - ${E(n)}${41===t?"+":""}`}if(T){const o=e/41,n=t/41;0===e?(T.style.left="0",T.style.width=100*n+"%"):(T.style.left=100*o+"%",T.style.width=100*(n-o)+"%")}_()}S&&S.addEventListener("input",A),C&&C.addEventListener("input",A);const P=document.getElementById("beds-min"),W=document.getElementById("beds-display"),B=document.getElementById("beds-fill"),$=document.getElementById("baths-min"),N=document.getElementById("baths-display"),F=document.getElementById("baths-fill");window.filterState.bedsMin=1,window.filterState.bathsMin=1,P&&P.addEventListener("input",function(){if(!P)return;const e=parseInt(P.value)||1;if(window.filterState.bedsMin=e,W&&(W.textContent=e>=6?"6+":`${e}+`),B){const t=(e-1)/5*100;B.style.width=`${t}%`}_()}),$&&$.addEventListener("input",function(){if(!$)return;const e=parseInt($.value)||1;if(window.filterState.bathsMin=e,N&&(N.textContent=e>=6?"6+":`${e}+`),F){const t=(e-1)/5*100;F.style.width=`${t}%`}_()});const D=document.getElementById("btn-homes"),O=document.getElementById("btn-condos");function R(){if(console.log("[updateActiveAreaMarkerInfoWindow] Called"),!window.activeMarker)return void console.log("[updateActiveAreaMarkerInfoWindow] No active marker");if(!window.activeMarker.areaData)return void console.log("[updateActiveAreaMarkerInfoWindow] Active marker has no areaData (not an area marker)");if(!window.infoWindow)return void console.log("[updateActiveAreaMarkerInfoWindow] No info window");if(!window.infoWindow.getMap())return void console.log("[updateActiveAreaMarkerInfoWindow] Info window not open");const e=!!D&&D.classList.contains("active"),t=!!O&&O.classList.contains("active");let o=null;if(e&&!t?o="homes":t&&!e&&(o="condos"),console.log("[updateActiveAreaMarkerInfoWindow] Before update:",{oldPropertyType:window.activeMarker.areaData.propertyType,newPropertyType:o,areaName:window.activeMarker.areaData.name,stats:window.activeMarker.areaData.stats?.listingCount,homeStats:window.activeMarker.areaData.homeStats?.listingCount,condoStats:window.activeMarker.areaData.condoStats?.listingCount}),window.activeMarker.areaData.propertyType=o,window.showPresetInfoWindowContent){console.log("[updateActiveAreaMarkerInfoWindow] Calling showPresetInfoWindowContent with skipCentering: true"),console.log("[updateActiveAreaMarkerInfoWindow] Function type:",typeof window.showPresetInfoWindowContent);try{window.showPresetInfoWindowContent(window.activeMarker,window.activeMarker.areaData,window.infoWindow,{skipCentering:!0}),console.log("[updateActiveAreaMarkerInfoWindow] showPresetInfoWindowContent call completed successfully")}catch(e){console.error("[updateActiveAreaMarkerInfoWindow] ERROR calling showPresetInfoWindowContent:",e)}}else console.log("[updateActiveAreaMarkerInfoWindow] showPresetInfoWindowContent not available")}D&&D.addEventListener("click",function(){this.classList.toggle("active"),_(),R()}),O&&O.addEventListener("click",function(){this.classList.toggle("active"),_(),R()}),document.querySelectorAll(".area-tag").forEach(e=>{e.addEventListener("click",function(){this.classList.toggle("selected");const e=this.getAttribute("data-zipcode"),t=this.getAttribute("data-subarea"),o=this.classList.contains("selected");e&&(o?(window.filterState.areas.add(e),window.showCustomBoundary(e)):(window.filterState.areas.delete(e),window.hideCustomBoundary(e)),"undefined"!=typeof gtag&&gtag("event","filter_area",{area:e,action:o?"selected":"deselected"})),t&&(o?window.filterState.areas.add(t):window.filterState.areas.delete(t),"undefined"!=typeof gtag&&gtag("event","filter_subarea",{subarea:t,action:o?"selected":"deselected"})),_();const n=window.areaPresets?.presets?.find(o=>e&&o.filterValue===e||t&&o.filterValue===t);n&&window.showAreaMarker&&window.hideAreaMarker&&(o?window.showAreaMarker(n):window.hideAreaMarker(n.slug))})}),document.querySelectorAll(".amenity-tag").forEach(e=>{e.addEventListener("click",function(){if(this.classList.contains("price-preset"))return;this.classList.toggle("selected");const e=this.getAttribute("data-amenity"),t=this.classList.contains("selected");e&&(t?(window.filterState.amenities.add(e),"Short-Term"===e?(window.filterState.amenities.delete("No Short-Term"),document.querySelector('.amenity-tag[data-amenity="No Short-Term"]')?.classList.remove("selected")):"No Short-Term"===e&&(window.filterState.amenities.delete("Short-Term"),document.querySelector('.amenity-tag[data-amenity="Short-Term"]')?.classList.remove("selected"))):window.filterState.amenities.delete(e),"undefined"!=typeof gtag&&gtag("event","filter_amenity",{amenity:e,action:t?"selected":"deselected"})),_()})});const H=e().get("subarea");if(H){const e=Array.from(document.querySelectorAll(".area-tag")).find(e=>e.getAttribute("data-subarea")===H);e&&e.click()}const q=e().get("propertyType")?.toLowerCase();if(q&&!window.isSingleMode){const e=document.getElementById("btn-homes"),t=document.getElementById("btn-condos");"homes"===q&&e?(e.classList.add("active"),t&&t.classList.remove("active"),_()):"condos"===q&&t&&(t.classList.add("active"),e&&e.classList.remove("active"),_())}function _(){const t=!!D&&D.classList.contains("active"),o=!!O&&O.classList.contains("active");window.filterState.propertyType=t&&!o?"homes":o&&!t?"condos":null;const n=window.filterState.areas,i=window.filterState.amenities,r=window.filterState.priceMin||0,a=window.filterState.priceMax||41,s=window.filterState.bedsMin||1,d=window.filterState.bathsMin||1;let l=0===r?0:L[r]||0,c=a>=41?Number.MAX_SAFE_INTEGER:L[a]||Number.MAX_SAFE_INTEGER;window.filteredNeighborhoods=(window.neighborhoods||[]).filter(e=>{let r=!0;if(t||o){r=!1;const n=(e.propertyType||"").toLowerCase();!t||"homes"!==n&&"townhomes"!==n||(r=!0),o&&"condos"===n&&(r=!0)}let a=!0;n.size>0&&(a=n.has(e.zipCode)||n.has(e.area)||n.has(e.subArea));let w=!0;i.size>0&&(w=[...i].every(t=>e.amenities&&e.amenities.includes(t)));let g=!0;const m=e.stats||{};let u=null!=m.minPrice?parseFloat(m.minPrice):null,p=null!=m.maxPrice?parseFloat(m.maxPrice):null;if((null===u||null===p)&&m.priceRange&&window.parseRange){const e=window.parseRange(m.priceRange);e&&(u=e.min,p=e.max)}null===u||null===p||isNaN(u)||isNaN(p)||(g=c>=u&&l<=p);let h=!0;if(s>1){const e=void 0!==m.maxBeds?parseFloat(m.maxBeds):null;null===e||isNaN(e)||(h=e>=s)}let f=!0;if(d>1){const e=void 0!==m.maxBaths?parseFloat(m.maxBaths):null;null===e||isNaN(e)||(f=e>=d)}return r&&a&&w&&g&&h&&f}),M(),window.addMarkers();const w=e().get("marker"),g=window.activeAreaSlug;w||g||window.fitBoundsToNeighborhoods()}window.findAreaButton=function(e){if(!e)return null;const{filterField:t,filterValue:o}=e;return"zipCode"===t?document.querySelector(`.area-tag[data-zipcode="${o}"]`):document.querySelector(`.area-tag[data-subarea="${o}"]`)},window.createAreaMarkerData=function(e,t=null){const o=(t||"").toLowerCase();let n=e.neighborhoods;return"homes"===o&&e.homeNeighborhoods?n=e.homeNeighborhoods:"condos"===o&&e.condoNeighborhoods&&(n=e.condoNeighborhoods),{name:e.name,position:e.position,stats:e.stats,homeStats:e.homeStats,condoStats:e.condoStats,neighborhoods:n,homeNeighborhoods:e.homeNeighborhoods,condoNeighborhoods:e.condoNeighborhoods,filterField:e.filterField,filterValue:e.filterValue,isAreaMarker:!0,propertyType:t}},document.querySelectorAll('input[name="sort"]').forEach(e=>{e.addEventListener("change",e=>{window.sortOrder=e.target.value,M(),h&&h.classList.add("hidden")})});let z=null;u&&u.addEventListener("input",e=>{const t=e.target.value.trim(),o=t.toLowerCase(),n=document.getElementById("search-results"),i=e=>{if(!t)return e;const o=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`(${n})`,"ig");return o.replace(i,"<strong>$1</strong>")};if(o&&"undefined"!=typeof gtag&&(clearTimeout(z),z=setTimeout(()=>{gtag("event","search_filter",{search_term:o})},500)),o){const e=a.filter(e=>e.name.toLowerCase().includes(o)||(e.location?.city||"").toLowerCase().includes(o)||(e.zipCode||"").includes(o)).sort((e,t)=>{const n=e.name.toLowerCase().includes(o)?0:1,i=t.name.toLowerCase().includes(o)?0:1;return n!==i?n-i:e.name.localeCompare(t.name)});e.length?n.innerHTML=e.map(e=>`\n                                <button class="search-result w-full text-left px-4 py-2 text-sm hover:bg-brand-100 dark:hover:bg-brand-dark/20 transition-colors cursor-pointer" data-name="${e.name}" data-type="${e.propertyType}">\n                                    ${i(e.name)} - ${i(e.propertyType)}\n                                </button>\n                            `).join(""):n.innerHTML='<div class="px-4 py-3 text-sm text-neutral-400">No matches found</div>'}else{const e=[...a].sort((e,t)=>(t.stats?.listingCount||0)-(e.stats?.listingCount||0)).slice(0,5);n.innerHTML=`\n                            <div class="px-4 py-2 text-xs font-medium text-neutral-400 dark:text-dark-text-secondary uppercase">Most Listings</div>\n                            ${e.map(e=>`\n                                <button class="search-result w-full text-left px-4 py-2 text-sm hover:bg-brand-100 dark:hover:bg-brand-dark/20 transition-colors cursor-pointer" data-name="${e.name}" data-type="${e.propertyType}">\n                                    ${e.name} - ${e.propertyType}\n                                </button>\n                            `).join("")}\n                        `}const r=document.getElementById("search-results");r&&r.scrollHeight>r.clientHeight+4?r.classList.add("has-overflow"):r&&r.classList.remove("has-overflow"),window.searchQuery=o,window.filteredNeighborhoods=o?(window.neighborhoods||[]).filter(e=>e.name.toLowerCase().includes(o)):[...window.neighborhoods||[]],M(),window.addMarkers&&window.addMarkers()});const Z=document.getElementById("search-results");if(Z&&Z.addEventListener("click",function(e){const t=e.target.closest(".search-result");if(!t)return;const o=t.dataset.name,n=t.dataset.type,i=(window.neighborhoods||[]).find(e=>e.name===o&&e.propertyType===n);if(i&&window.map){"undefined"!=typeof gtag&&gtag("event","search_select",{neighborhood_name:i.name,search_query:u?.value||""}),window.smoothFlyTo(i.position,window.map.getZoom());const e=(window.markers||[]).find(e=>e.neighborhood.name===o&&e.neighborhood.propertyType===n);if(e){const t=window.map.getCenter(),o=new google.maps.LatLng(i.position),n=google.maps.geometry.spherical.computeDistanceBetween(t,o);setTimeout(()=>{google.maps.event.trigger(e.marker,"click")},n<2e3?450:2200)}}m&&m.classList.add("hidden"),u&&(u.value=""),window.searchQuery="",window.filteredNeighborhoods=[...window.neighborhoods||[]],M(),window.addMarkers&&window.addMarkers()}),M(),window.visualViewport){const e=()=>{const e=document.getElementById("sort-menu"),t=document.getElementById("search-dropdown");if(e&&!e.classList.contains("hidden")&&(e.classList.add("hidden"),setTimeout(()=>e.classList.remove("hidden"),10)),t&&!t.classList.contains("hidden")){const e=document.getElementById("search-input");document.activeElement!==e&&t.classList.add("hidden")}};window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)}}function o(e,t,o){const n=Math.pow(2,o),i=e*Math.PI/180,r=Math.log(Math.tan(Math.PI/4+i/2))+t/(256*n/(2*Math.PI));return 180*(2*Math.atan(Math.exp(r))-Math.PI/2)/Math.PI}function n(e,t=!1){const o=document.getElementById("map"),n=o?.offsetWidth||window.innerWidth,i=o?.offsetHeight||window.innerHeight,r=n<640?450:n<1024?380:340,a=t?r+70:r,s=window.TAIL_HEIGHT||78,d=window.MARKER_RADIUS||10;if(i>=450&&a+s+d<i-40)return Math.round((a+s-d)/2);{const e=20+a+s+d;return Math.round(Math.max(0,e-i/2))}}"true"!==new URLSearchParams(window.location.search.replace(/&amp;/g,"&")).get("debug")&&(document.addEventListener("contextmenu",e=>(e.preventDefault(),!1)),document.addEventListener("keydown",e=>"F12"===e.key||e.ctrlKey&&e.shiftKey&&("I"===e.key||"J"===e.key||"C"===e.key)||e.ctrlKey&&("u"===e.key||"U"===e.key)||e.ctrlKey&&("s"===e.key||"S"===e.key)?(e.preventDefault(),!1):void 0)),window.addEventListener("dataLoaded",t),document.addEventListener("DOMContentLoaded",()=>{window.neighborhoods&&window.neighborhoods.length>0&&t()});let i=!1,r=!1;function a(){const e=document.getElementById("single-mode-overlay");e&&(e.style.opacity="0",setTimeout(()=>{e.style.display="none",console.log("Single mode: overlay hidden")},300))}function s(){window.singleModeResizeObserver&&(window.singleModeResizeObserver.disconnect(),window.singleModeResizeObserver=null,console.log("Single mode: ResizeObserver disconnected"))}function d(e,t=0,o=!1){return window.applyCenteringFromRenderedCard(e,{maxRetries:30,usePaddingMethod:!1,attempt:t,onComplete:()=>{window.singleModeOffsetApplied=!0,o&&!r&&(r=!0,setTimeout(()=>{window.logCenteringDiagnostics?.(e)},500))}})}function l(){const t=document.getElementById("map");if(!t)return;t.innerHTML="";const r=e(),l="single"===r.get("mode"),w="false"===r.get("controls"),u=(r.get("neighborhood")||r.get("marker"))?.toLowerCase();window.isSingleMode=l;let f={lat:30.32,lng:-86.05},v=11,y=null;const k=r.get("area")?.toLowerCase();if(l&&u){const e=window.NEIGHBORHOOD_POSITIONS?.[u];if(e)v=parseInt(r.get("zoom"))||13,f=e,y=e,console.log("Single mode: using NEIGHBORHOOD_POSITIONS for",u);else if(window.neighborhoods){const e=window.neighborhoods.find(e=>window.toSlug&&window.toSlug(e.name)===u);e&&e.position&&(v=parseInt(r.get("zoom"))||13,f=e.position,y=e.position)}if(!y){const e=window.AREA_POSITIONS?.[u];e&&(v=parseInt(r.get("zoom"))||13,f=e,y=e,window.singleModeIsArea=!0,console.log("Single mode: using AREA_POSITIONS for",u))}}else if(l&&k){const e=window.AREA_POSITIONS?.[k];if(e)v=parseInt(r.get("zoom"))||13,f=e,y=e,window.singleModeIsArea=!0,console.log("Single mode: using AREA_POSITIONS for",k);else{const e=window.areaPresets?.presets?.find(e=>e.slug===k);e&&e.position&&(v=parseInt(r.get("zoom"))||13,f=e.position,y=e.position,window.singleModeIsArea=!0)}}let b=f;if(window.singleModeOffsetApplied=!1,window.singleModeTarget=y,l&&y){const e=document.getElementById("single-mode-overlay");e&&(e.style.display="flex",e.style.opacity="1");const t=n(0,window.singleModeIsArea||!1);b={lat:o(f.lat,t,v),lng:f.lng},console.log("Single mode: pre-offset applied, estimated offset:",t,"px"),setTimeout(()=>{i||(console.warn("Single mode: fallback timeout - fading overlay"),a(),i=!0)},5e3)}function x(){const e=document.querySelector(".gm-style-iw-chr");e&&e.remove()}window.map=new google.maps.Map(t,{zoom:v,center:b,mapId:"92b2f4ea8b2fce54a50ed2e9",disableDefaultUI:w,mapTypeControl:!w,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!w,fullscreenControl:!w,zoomControl:!w,clickableIcons:!1}),google.maps.event.trigger(window.map,"resize"),window.infoWindow=new google.maps.InfoWindow({maxWidth:320,disableAutoPan:!0}),window.hoverInfoWindow=new google.maps.InfoWindow({maxWidth:320,disableAutoPan:!0}),window.infoWindow.addListener("domready",x),window.hoverInfoWindow.addListener("domready",x),window.tryInitializeMarkers=function(){if(window.markersInitialized)return;const t=window.neighborhoods||[];if(!t.length||!window.map||!window.addMarkers)return;window.markersInitialized=!0;const n=e(),i="single"===n.get("mode"),r=(n.get("neighborhood")||n.get("marker"))?.toLowerCase(),l=n.get("area")?.toLowerCase(),w=n.get("propertyType")?.toLowerCase();if(i){let e=null;if(r&&!l&&t.length>0){const o=t.filter(e=>window.toSlug(e.name)===r);if(o.length>0){const t=w||"homes";e=o.find(e=>(e.propertyType||"").toLowerCase()===t)||o[0],window.neighborhoods=[e],window.filteredNeighborhoods=[e],console.log("Single mode: neighborhood",e.name)}}else if(l){const t=window.areaPresets?.presets?.find(e=>e.slug===l);t&&(e=window.createAreaMarkerData(t,w),window.filteredNeighborhoods=[e],console.log("Single mode: area",t.name,"propertyType:",w||"all"))}}window.filteredNeighborhoods&&window.filteredNeighborhoods.length||(window.filteredNeighborhoods=[...t]),window.addMarkers(),console.log("Map initialized with",window.filteredNeighborhoods.length,"neighborhoods"),function(){if(i&&(l||r))return void setTimeout(()=>{let e=0;const t=()=>{e++,function(){if(!window.markers||0===window.markers.length)return!1;const e=window.markers[0];if(e&&e.marker&&e.neighborhood){console.log("Single mode: opening",e.neighborhood.name),e.neighborhood.isAreaMarker?p(e.marker,e.neighborhood,window.infoWindow):h(e.marker,e.neighborhood,window.infoWindow,!0),google.maps.event.addListenerOnce(window.infoWindow,"domready",()=>{requestAnimationFrame(()=>{const t=e.neighborhood?.position||e.marker?.position||e.marker?.getPosition&&e.marker.getPosition();if(!t)return;const o=t instanceof google.maps.LatLng?t:new google.maps.LatLng(t);d(o,0,!0),a(),s();let n=null;window.singleModeResizeObserver=new ResizeObserver(()=>{n&&clearTimeout(n),n=setTimeout(()=>{d(o,999,!1)},150)});const i=document.querySelector(".gm-style-iw-c");i&&window.singleModeResizeObserver.observe(i)})});const t=e.marker.isAreaMarker?m:g;return e.marker.content.innerHTML=t(e.marker.markerColor,!0),window.activeMarker=e.marker,!0}return!1}()||(e<30?setTimeout(t,100):console.warn("Single mode: marker not found after 3 seconds"))};t()},300);const e=n.get("marker")?.toLowerCase();if(e||window.fitBoundsToNeighborhoods(),e){const i=window.areaPresets?.presets?.find(t=>t.slug===e);if(i){const e=n.get("propertyType")?.toLowerCase();if(e){const t=document.getElementById("btn-homes"),o=document.getElementById("btn-condos");"homes"===e&&t?(t.classList.add("active"),o&&o.classList.remove("active")):"condos"===e&&o&&(o.classList.add("active"),t&&t.classList.remove("active")),window.pendingAreaPropertyType=e}google.maps.event.addListenerOnce(window.map,"tilesloaded",()=>{setTimeout(()=>{const e=window.findAreaButton(i);e&&e.click()},400)})}else{const i=(n.get("propertyType")||"homes").toLowerCase(),r=t.filter(t=>window.toSlug(t.name)===e);if(r.length>0){const e=r.find(e=>(e.propertyType||"").toLowerCase()===i)||r[0];google.maps.event.addListenerOnce(window.map,"tilesloaded",()=>{setTimeout(()=>{const t=(window.markers||[]).find(t=>t.neighborhood.name===e.name&&t.neighborhood.propertyType===e.propertyType);if(t){const n=14,i=40,r=(window.useMiniInfoWindow,c(0,i)),a={lat:o(e.position.lat,r,n),lng:e.position.lng};console.log("?marker: Flying to",e.name,"with pre-offset:",r,"px"),smoothFlyTo(a,n),google.maps.event.addListenerOnce(window.map,"idle",()=>{h(t.marker,e,window.infoWindow,!0),window.activeMarker=t.marker;const o=t.marker.isAreaMarker?m:g;t.marker.content.innerHTML=o(t.marker.markerColor,!0),google.maps.event.addListenerOnce(window.infoWindow,"domready",()=>{requestAnimationFrame(()=>{const t=new google.maps.LatLng(e.position);window.applyCenteringFromRenderedCard(t,{maxRetries:30,usePaddingMethod:!1,onComplete:()=>{console.log("?marker: Phase 2 correction applied"),setTimeout(()=>{window.logCenteringDiagnostics&&window.logCenteringDiagnostics(t)},100)}})})})})}},400)})}}}}()},window.tryInitializeMarkers();let M=null;window.map.addListener("idle",()=>{if(window.map){const e=Math.round(window.map.getZoom());e!==M&&(console.log("Zoom:",e),M=e)}}),window.map.addListener("click",()=>{if(window.infoWindow&&window.infoWindow.getMap()&&window.infoWindow.close(),window.hoverInfoWindow&&window.hoverInfoWindow.getMap()&&window.hoverInfoWindow.close(),window.activeMarker&&window.activeMarker.content){const e=window.activeMarker.isAreaMarker?m:g;window.activeMarker.content.innerHTML=e(window.activeMarker.markerColor,!1),window.activeMarker=null}}),window.isSingleMode||window.map.addListener("center_changed",()=>{window.infoWindow&&window.infoWindow.getMap()&&window.activeMarker&&window.infoWindow.open({map:window.map,anchor:window.activeMarker})})}function c(e,t=0){const o=n(0,!1);return Math.round(o+t/2)}function w(e,t,o){const n=window.map,i=Math.pow(2,o||n.getZoom()),r=n.getProjection().fromLatLngToPoint(new google.maps.LatLng(e)),a=new google.maps.Point(0,-t/i),s=new google.maps.Point(r.x,r.y+a.y),d=n.getProjection().fromPointToLatLng(s);return console.log("offsetLatLng:",{inputLat:e.lat,offsetPx:t,zoom:o,scale:i,outputLat:d.lat(),latDiff:d.lat()-e.lat}),{lat:d.lat(),lng:e.lng}}window.customBoundaries||(window.customBoundaries=new Set),window.fitBoundsToNeighborhoods=function(e=0){const t=window.map,o=window.filteredNeighborhoods||[];if(!t||0===o.length)return;const n=new google.maps.LatLngBounds;if(o.forEach(e=>{e.position&&n.extend(new google.maps.LatLng(e.position))}),!n.isEmpty()){const o=window.innerWidth<768?50:150;t.setOptions({maxZoom:15}),t.fitBounds(n,{top:50,right:o,bottom:60,left:o});const i=google.maps.event.addListener(t,"idle",()=>{if(t.setOptions({maxZoom:22}),!window.skipZoomAdjust){const o=t.getZoom();e>0&&o<e&&t.setZoom(e)}google.maps.event.removeListener(i)})}},window.smoothFlyTo=function(e,t){const o=window.map;if(!o)return;const n=window.CONFIG?.map||{};void 0===t&&(t=n.defaultZoom||14);const i=o.getCenter(),r=o.getZoom(),a=new google.maps.LatLng(e),s=w(e,c(0,40),t),d=c(0,40),l=w({lat:i.lat(),lng:i.lng()},-d,r),g=new google.maps.LatLng(l),m=google.maps.geometry.spherical.computeDistanceBetween(g,a),u=n.flightZoomArc||{},p=n.flightDuration||{},h=performance.now();let f,v,y;f=m<1e3?p.micro||800:m<2e3?p.short||1200:p.medium||2e3,m<(u.micro?.maxDistance||2e3)?(v=u.micro?.minZoom||13,y="micro"):m<(u.short?.maxDistance||5e3)?(v=u.short?.minZoom||13,y="short"):m<(u.medium?.maxDistance||2e4)?(v=u.medium?.minZoom||12,y="med"):(v=u.long?.minZoom||10,y="long"),v=r>=t?Math.min(v,r-1,t-1):r,console.log(`Flight: ${y} | ${(m/1e3).toFixed(2)}km | minZoom=${v}`),requestAnimationFrame(function e(n){const a=n-h,d=Math.min(a/f,1),l=d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,c=i.lat()+(s.lat-i.lat())*l,w=i.lng()+(s.lng-i.lng())*l;let g;if(d<.5){const e=2*d,t=1-Math.pow(1-e,2);g=r+(v-r)*t}else{const e=2*(d-.5);g=v+e*e*(t-v)}o.moveCamera({center:{lat:c,lng:w},zoom:g}),d<1&&requestAnimationFrame(e)})},window.navigateNeighborhood=function(e){const t=window.filteredNeighborhoods||[];if(t.length<1)return;console.log("[Nav Debug] filteredNeighborhoods count:",t.length,"first 3:",t.slice(0,3).map(e=>e.name));const o=window.sortOrder||"listings-desc",n=[...t].sort((e,t)=>{const n=e.stats?.medianPrice||e.stats?.avgPrice||0,i=t.stats?.medianPrice||t.stats?.avgPrice||0,r=e.stats?.listingCount||0,a=t.stats?.listingCount||0;switch(o){case"name-asc":default:return e.name.localeCompare(t.name);case"name-desc":return t.name.localeCompare(e.name);case"price-asc":return n-i;case"price-desc":return i-n;case"listings-desc":return a-r}}),i=window.currentNeighborhood;let r,a=-1;i&&!i.isAreaMarker&&(a=n.findIndex(e=>e.name===i.name&&e.propertyType===i.propertyType)),-1===a?r=1===e?0:n.length-1:(r=a+e,r<0&&(r=n.length-1),r>=n.length&&(r=0));const s=n[r];if(!s)return;console.log("[Nav Debug] navigating to:",s.name,"position:",s.position,"index:",r,"of",n.length);const d=(window.markers||[]).find(e=>e.neighborhood.name===s.name&&e.neighborhood.propertyType===s.propertyType);if(d&&d.marker){const t=-1===e?"nav-prev":"nav-next",o=document.getElementById(t);o&&o.classList.add("bg-brand-100","dark:bg-brand-dark/20"),setTimeout(()=>{if(window.infoWindow&&window.infoWindow.getMap()&&window.infoWindow.close(),window.activeMarker&&window.activeMarker.content){const e=window.activeMarker.isAreaMarker?m:g;window.activeMarker.content.innerHTML=e(window.activeMarker.markerColor,!1),window.activeMarker=null}window.smoothFlyTo(s.position,window.map.getZoom());const e=window.map.getCenter(),t=new google.maps.LatLng(s.position),o=google.maps.geometry.spherical.computeDistanceBetween(e,t);setTimeout(()=>{google.maps.event.trigger(d.marker,"click")},o<2e3?450:2200)},150)}};function g(e,t=!1){const o=t?44:32,n=t?10:6;return`\n                <svg width="${o}" height="${o}" viewBox="0 0 ${o} ${o}" xmlns="http://www.w3.org/2000/svg">\n                    ${t?`\n                        <circle cx="${o/2}" cy="${o/2}" r="${n}"\n                            fill="none"\n                            stroke="${e}"\n                            stroke-width="4"\n                            opacity="0.7">\n                            <animate attributeName="r"\n                                from="${n}"\n                                to="${o/2-2}"\n                                dur="1.5s"\n                                repeatCount="indefinite"/>\n                            <animate attributeName="opacity"\n                                from="0.7"\n                                to="0"\n                                dur="1.5s"\n                                repeatCount="indefinite"/>\n                        </circle>\n                    `:""}\n                    <circle cx="${o/2}" cy="${o/2}" r="${n}"\n                        fill="${e}"\n                        stroke="white"\n                        stroke-opacity="0.75"\n                        stroke-width="${t?3:2}"/>\n                </svg>\n            `}function m(e,t=!1){const o="22,10 34,22 22,34 10,22";return`\n        <svg width="44" height="44" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">\n            <polygon points="${o}"\n                fill="none"\n                stroke="${e}"\n                stroke-width="4"\n                opacity="0.7">\n                <animate attributeName="points"\n                    from="${o}"\n                    to="22,2 42,22 22,42 2,22"\n                    dur="1.5s"\n                    repeatCount="indefinite"/>\n                <animate attributeName="opacity"\n                    from="0.7"\n                    to="0"\n                    dur="1.5s"\n                    repeatCount="indefinite"/>\n            </polygon>\n            <polygon points="${o}"\n                fill="${e}"\n                stroke="white"\n                stroke-opacity="0.85"\n                stroke-width="3"/>\n        </svg>\n    `}function u(e){const t=e.name,o=(e.propertyType||"").toLowerCase();return"homes"===o?t+" Homes":"condos"===o?t+" Condos":"townhomes"===o?t+" T/H":"lots"===o?t+" Lots":t}function p(e,t,o,n={}){const{skipCentering:i=!1}=n;if(console.log("[showPresetInfoWindowContent] Called with skipCentering:",i,"options:",n),window.useMiniInfoWindow&&window.showMiniInfoWindowContent)return window.showMiniInfoWindowContent(e,t,o);if(i){console.log("[showPresetInfoWindowContent] Attempting DOM-only update...");const e=function(e){let t;if(console.log("[updateInfoWindowStatsOnly] Called with area:",e.name,"propertyType:",e.propertyType),window.getAreaStats)t=window.getAreaStats(e,e.propertyType);else{const o=(e.propertyType||"").toLowerCase();t="homes"===o?e.homeStats||e.stats||{}:"condos"===o?e.condoStats||e.stats||{}:e.stats||{}}console.log("[updateInfoWindowStatsOnly] Stats to apply:",t);const o=document.querySelector(".info-window");if(!o)return console.log("[updateInfoWindowStatsOnly] ERROR: No .info-window element found"),!1;console.log("[updateInfoWindowStatsOnly] Found .info-window element");const n=o.querySelector(".info-window h3, .info-window-title, h3.text-base.sm\\:text-lg");n&&(n.textContent=u(e),console.log("[updateInfoWindowStatsOnly] Updated title to:",n.textContent));const i=o.querySelector('[data-stat="listingCount"]'),r=o.querySelector('[data-stat="medianPrice"]'),a=o.querySelector('[data-stat="avgPricePerSqFt"]'),s=o.querySelector('[data-stat="avgDom"]');if(console.log("[updateInfoWindowStatsOnly] Found stat elements:",{listingCount:!!i,medianPrice:!!r,avgPricePerSqFt:!!a,avgDom:!!s}),i&&r&&a&&s){const e=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M");return i.textContent=t.listingCount||0,r.textContent=e(t.medianPrice||0),a.textContent="$"+(t.avgPricePerSqFt||0).toLocaleString(),s.textContent=t.avgDom||0,console.log("[updateInfoWindowStatsOnly] SUCCESS: Stats updated via DOM"),!0}return console.log("[updateInfoWindowStatsOnly] ERROR: Could not find all stat elements with data attributes"),!1}(t);if(console.log("[showPresetInfoWindowContent] DOM update result:",e),e)return void console.log("[showPresetInfoWindowContent] SUCCESS: Stats updated via DOM-only method, returning early");console.log("[showPresetInfoWindowContent] FALLBACK: DOM update failed, continuing with full render")}let r;if(console.log("[showPresetInfoWindowContent] Area:",t.name,"PropertyType:",t.propertyType),console.log("[showPresetInfoWindowContent] Available stats:",{stats:t.stats?.listingCount,homeStats:t.homeStats?.listingCount,condoStats:t.condoStats?.listingCount}),window.getAreaStats)console.log("[showPresetInfoWindowContent] Using window.getAreaStats"),r=window.getAreaStats(t,t.propertyType);else{console.log("[showPresetInfoWindowContent] Using inline fallback");const e=(t.propertyType||"").toLowerCase();r="homes"===e?t.homeStats||t.stats||{}:"condos"===e?t.condoStats||t.stats||{}:t.stats||{}}console.log("[showPresetInfoWindowContent] Selected stats:",{listingCount:r.listingCount,medianPrice:r.medianPrice});const a=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M"),s=(t.neighborhoods||[]).slice(0,10).map(e=>e.name).join(", "),d=`\n                <div class="info-window p-2 sm:p-3 max-w-sm bg-white dark:bg-dark-bg-elevated">\n                    <h3 class="text-base sm:text-lg font-semibold text-neutral-800 dark:text-dark-text-primary mb-2 text-center">${u(t)}</h3>\n                    <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary" data-stat="listingCount">${r.listingCount||0}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Active</div>\n                        </div>\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary" data-stat="medianPrice">${a(r.medianPrice||0)}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Median</div>\n                        </div>\n                    </div>\n                    <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary" data-stat="avgPricePerSqFt">$${(r.avgPricePerSqFt||0).toLocaleString()}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">$/SF</div>\n                        </div>\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary" data-stat="avgDom">${r.avgDom||0}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg DOM</div>\n                        </div>\n                    </div>\n                    <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 p-2 sm:p-3 rounded-lg border border-neutral-200 dark:border-dark-border mb-2 sm:mb-3">\n                        <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-1">Top Neighborhoods</div>\n                        <div class="communities-scroll text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">${s}</div>\n                    </div>\n                    <hr class="divider mb-2 sm:mb-3">\n                    <div class="pt-2 sm:pt-3 flex items-center gap-1.5 sm:gap-2">\n                        ${(()=>{const e=(window.filteredNeighborhoods||[]).length>1,o=e?'<button id="nav-prev" onclick="window.navigateNeighborhood(-1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Previous Community"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button>':"",n=e?'<button id="nav-next" onclick="window.navigateNeighborhood(1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Next Community"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></button>':"";if(window.isSingleMode)return o+'<a href="'+("localhost"===window.location.hostname?window.location.origin:"https://neighborhoods.truesouthcoastalhomes.com")+"?marker="+t.name.toLowerCase().replace(/[^a-z0-9]+/g,"-")+'" target="_blank" class="flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors" title="Open '+t.name+' in Neighborhood Finder">Neighborhood Finder&trade; <svg style="display:inline;width:1.1em;height:1.1em;vertical-align:middle;margin-left:2px" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg></a>'+n;{const e=(window.areaPresets?.presets||[]).find(e=>e.name===t.name);return o+'<a href="https://www.truesouthcoastalhomes.com/property-search/results/?searchtype=3#listtype_1/'+(e?.listingsParam||"area_"+encodeURIComponent(t.name)+"/")+'" target="_blank" class="flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors" onclick="event.stopPropagation();" title="View all '+t.name+' listings">Matching Listings</a>'+n}})()}\n                    </div>\n                </div>\n            `;o.setContent(d),i||o.open(window.map,e),google.maps.event.addListenerOnce(o,"domready",()=>{const t=document.querySelector(".communities-scroll");t&&t.scrollHeight>t.clientHeight+4&&t.classList.add("has-overflow"),window.isSingleMode||i||setTimeout(()=>{e?.position&&(window.applyCenteringFromRenderedCard?window.applyCenteringFromRenderedCard(e.position,{usePaddingMethod:!1,onComplete:()=>{window.logCenteringDiagnostics&&window.logCenteringDiagnostics(e.position)}}):window.logCenteringDiagnostics&&window.logCenteringDiagnostics(e.position))},300)})}function h(e,t,o,n=!0){if(t.isAreaMarker)return p(e,t,o);if(window.useMiniInfoWindow&&window.showMiniInfoWindowContent)return window.showMiniInfoWindowContent(e,t,o);n&&o===window.infoWindow&&(window.currentNeighborhood=t);const i=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M"),r=t.stats||{},a=i(r.medianPrice||r.avgPrice||0),d=r.avgPricePerSqFt||(r.avgSqft>0?Math.round((r.avgPrice||0)/r.avgSqft):0),l=window.filterState&&window.filterState.amenities?window.filterState.amenities:new Set,c=(t.propertyType||"homes").toLowerCase(),w=window.filterState||{},h=w.bedsMin||1,f=w.bathsMin||1,v=w.priceMin>0?window.PRICE_STEPS[w.priceMin]:null,y=w.priceMax<41?window.PRICE_STEPS[w.priceMax]:null,k=h>1?`beds_${h}/`:"",b=f>1?`baths_${f}/`:"",x=v?`lprice_${v}/`:"",M=y&&y<35e6?`uprice_${y}/`:"";let L="";L=c.includes("townhome")?"listtypedescrip_attached%20single%20unit/":c.includes("condo")?"listtypedescrip_condominium/":c.includes("lot")||c.includes("land")||c.includes("vacant")?"":"listtypedescrip_detached%20single%20family/";let S="listtype_1";(c.includes("lot")||c.includes("land")||c.includes("vacant"))&&(S="listtype_4");const C=`#${S}/${x}${M}${k}${b}${L}`;let I;I=t.mlsSubdivisions&&t.mlsSubdivisions.length>0?`subdivision=${t.mlsSubdivisions.map(e=>e.replace(/ /g,"+")).join(",")}`:`subdivision=${t.name.replace(/ /g,"+")}`;const T=`https://www.truesouthcoastalhomes.com/property-search/results/?searchtype=3&${I}${C}`,E=(window.filteredNeighborhoods||[]).length>1,A=`\n                <div class="info-window p-2 sm:p-3 max-w-sm bg-white dark:bg-dark-bg-elevated" style="cursor: pointer;" tabindex="-1">\n                    <div class="flex items-center justify-center gap-2 mb-2">\n                        <h3 class="text-base sm:text-lg font-semibold text-neutral-800 dark:text-dark-text-primary">${u(t)}</h3>\n                        ${t.urlSlug?`\n                        <a href="https://www.truesouthcoastalhomes.com${t.urlSlug}"\n                           target="_blank"\n                           class="text-brand-500 dark:text-brand-dark hover:text-brand-600 dark:hover:text-brand-dark-hover transition-colors focus-ring rounded"\n                           onclick="event.stopPropagation();"\n                           title="${t.name} ${t.propertyType} for Sale">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>\n                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>\n                            </svg>\n                        </a>\n                        `:""}\n                    </div>\n                    <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">${r.listingCount||0}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Active</div>\n                        </div>\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">${a}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Median</div>\n                        </div>\n                    </div>\n                    <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">$${d.toLocaleString()}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">$/SF</div>\n                        </div>\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">${r.avgDom||0}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg DOM</div>\n                        </div>\n                    </div>\n                    ${(t.amenities||[]).length>0?`\n                    <div class="mb-2 sm:mb-3">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 p-2 sm:p-3 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-1">Amenities</div>\n                            <div class="amenities-scroll text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary leading-tight">${((e=[])=>e.map(e=>{const t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return l.has(e)?`<strong>${t}</strong>`:t}).join(", ")+".")(t.amenities||[])}</div>\n                        </div>\n                    </div>\n                    `:""}\n                    <hr class="divider mb-2 sm:mb-3">\n                    <div class="pt-2 sm:pt-3 flex items-center gap-1.5 sm:gap-2">\n                        ${E?'\n                        <button id="nav-prev" onclick="window.navigateNeighborhood(-1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Previous Community">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>\n                        </button>\n                        ':""}\n                        ${(()=>{if(window.isSingleMode){const e=window.toSlug(t.name),o=t.propertyType?"&propertyType="+encodeURIComponent(t.propertyType):"";return'<a href="'+("localhost"===window.location.hostname?window.location.origin:"https://neighborhoods.truesouthcoastalhomes.com")+"?marker="+e+o+'" target="_blank" class="flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors" title="Open '+t.name+' in Neighborhood Finder">Neighborhood Finder&trade; <svg style="display:inline;width:1.1em;height:1.1em;vertical-align:middle;margin-left:2px" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg></a>'}return T?'<a href="'+T+"\" target=\"_blank\" class=\"flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors\" onclick=\"event.stopPropagation(); if(typeof gtag!=='undefined')gtag('event','view_listings',{neighborhood_name:'"+t.name+"',listing_count:"+(r.listingCount||0)+",property_type:'"+t.propertyType+'\'});" title="View all '+t.name+" "+t.propertyType+' for sale">Matching Listings</a>':'<button class="flex-1 bg-neutral-300 dark:bg-dark-bg-elevated-2 text-neutral-500 dark:text-dark-text-secondary py-2.5 px-4 rounded-lg font-medium opacity-50 cursor-not-allowed" disabled title="MLS listings coming soon for '+t.name+'">Coming Soon!</button>'})()}\n                        ${E?'\n                        <button id="nav-next" onclick="window.navigateNeighborhood(1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Next Community">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>\n                        </button>\n                        ':""}\n                    </div>\n                </div>\n            `;o.setContent(A),o.open({map:window.map,anchor:e}),google.maps.event.addListenerOnce(o,"domready",()=>{const t=document.querySelector(".amenities-scroll");t&&t.scrollHeight>t.clientHeight+4&&t.classList.add("has-overflow"),window.isSingleMode||setTimeout(()=>{e?.position&&(window.applyMicroCenteringCorrection&&window.applyMicroCenteringCorrection(e.position,100),window.logCenteringDiagnostics&&window.logCenteringDiagnostics(e.position))},300)}),o===window.infoWindow&&(google.maps.event.clearListeners(window.infoWindow,"closeclick"),window.infoWindow.addListener("closeclick",()=>{if(window.activeMarker&&window.activeMarker.content){const e=window.activeMarker.isAreaMarker?m:g;window.activeMarker.content.innerHTML=e(window.activeMarker.markerColor,!1)}window.activeMarker=null,s()}))}window.activeMarker=null,window.showPresetInfoWindowContent=p,console.log("[CACHE CHECK] main.js loaded at:",(new Date).toISOString(),"showPresetInfoWindowContent type:",typeof p),window.areaMarkers=new Map,window.activeAreaSlug=null,window.showAreaMarker=function(e){const t=function(e){const t=window.neighborhoods||[],o=e.filterField,n=e.filterValue,i=t.filter(e=>e[o]===n);if(0===i.length)return null;let r=0,a=0,s=0;return i.forEach(e=>{e.position&&(r+=e.position.lat,a+=e.position.lng,s++)}),0===s?null:{lat:r/s,lng:a/s}}(e)||e.position;window.activeAreaSlug=e.slug;const o=window.pendingAreaPropertyType||null;window.pendingAreaPropertyType=null;const n=window.createAreaMarkerData(e,o);n.position=t;const i=document.createElement("div");i.className="marker-pin area-marker",i.innerHTML=m("#F4A261",!0),i.style.cursor="pointer",i.style.zIndex="1000";const r=new google.maps.marker.AdvancedMarkerElement({map:window.map,position:t,content:i,title:n.name+" (Area)",zIndex:1e3});r.markerColor="#F4A261",r.isAreaMarker=!0,r.areaSlug=e.slug,r.addListener("click",()=>{if(window.activeMarker===r&&window.infoWindow?.getMap())window.infoWindow.close(),r.content.innerHTML=m(r.markerColor,!1),window.activeMarker=null;else{if(window.activeMarker&&window.activeMarker.content){const e=window.activeMarker.isAreaMarker?m:g;window.activeMarker.content.innerHTML=e(window.activeMarker.markerColor,!1)}p(r,n,window.infoWindow),r.content.innerHTML=m(r.markerColor,!0),window.activeMarker=r,window.activeAreaSlug=e.slug}}),r.areaData=n,window.areaMarkers.set(e.slug,r),window.fitBoundsToNeighborhoods&&window.fitBoundsToNeighborhoods();const a=google.maps.event.addListener(window.map,"idle",()=>{window.activeAreaSlug===e.slug&&(p(r,n,window.infoWindow),window.activeMarker=r),google.maps.event.removeListener(a)})},window.hideAreaMarker=function(e){const t=window.areaMarkers.get(e);if(t)if(t.map=null,window.areaMarkers.delete(e),window.activeAreaSlug===e){window.infoWindow?.close(),window.activeMarker=null,window.activeAreaSlug=null;const e=Array.from(window.areaMarkers.keys());if(e.length>0){const t=e[e.length-1],o=window.areaMarkers.get(t);if(window.activeAreaSlug=t,window.fitBoundsToNeighborhoods&&window.fitBoundsToNeighborhoods(),o&&o.areaData){const e=()=>{window.activeAreaSlug===t&&(p(o,o.areaData,window.infoWindow),window.activeMarker=o),google.maps.event.removeListener(n)},n=google.maps.event.addListener(window.map,"idle",e)}}}else window.areaMarkers.size>0&&window.fitBoundsToNeighborhoods&&window.fitBoundsToNeighborhoods()},window.addMarkers=function(){if(!window.map)return;(window.markers||[]).forEach(e=>e.marker.setMap(null)),window.markers=[];const e=window.filteredNeighborhoods||[];window.formatPrice;let t=null;e.forEach(e=>{if(e.isAreaMarker){const o="#F4A261",n=document.createElement("div");n.className="marker-pin area-marker",n.innerHTML=m(o,!0),n.style.cursor="pointer",n.style.zIndex="1000";const i=new google.maps.marker.AdvancedMarkerElement({map:window.map,position:e.position,content:n,title:e.name+" (Area)",zIndex:1e3});return i.markerColor=o,i.isAreaMarker=!0,i.addListener("click",()=>{if(window.activeMarker===i&&window.infoWindow?.getMap())window.infoWindow.close(),i.content.innerHTML=m(i.markerColor,!1),window.activeMarker=null;else{if(window.activeMarker&&window.activeMarker.content){const e=window.activeMarker.isAreaMarker?m:g;window.activeMarker.content.innerHTML=e(window.activeMarker.markerColor,!1)}h(i,e,window.infoWindow,!0),i.content.innerHTML=m(i.markerColor,!0),window.activeMarker=i}}),window.markers.push({marker:i,neighborhood:e}),void(t={marker:i,neighborhood:e})}const o=e.urlSlug&&""!==e.urlSlug,n=e.mlsSubdivisions&&e.mlsSubdivisions.length>0||e.name&&""!==e.name,i=o?"#4c8f96":n?"#4a5462":"#9ca3af",r=document.createElement("div");r.className="marker-pin",r.innerHTML=g(i,!1),r.style.cursor="pointer";const a=new google.maps.marker.AdvancedMarkerElement({map:window.map,position:e.position,content:r,title:e.name});a.markerColor=i,a.addListener("click",()=>{!function(e,t,o){const n=e.markerColor,i=e=>e.isAreaMarker?m:g;if(window.activeMarker===e)window.infoWindow&&window.infoWindow.getMap()?(window.infoWindow.close(),e.content.innerHTML=i(e)(n,!1),window.activeMarker=null,s()):(o(),e.content.innerHTML=i(e)(n,!0));else{if(window.activeMarker&&window.activeMarker.content){const e=i(window.activeMarker);window.activeMarker.content.innerHTML=e(window.activeMarker.markerColor,!1)}o(),e.content.innerHTML=i(e)(n,!0),window.activeMarker=e}}(a,0,()=>{h(a,e,window.infoWindow,!0)})}),r.addEventListener("mouseenter",()=>{window.activeMarker!==a&&h(a,e,window.hoverInfoWindow,!1)}),r.addEventListener("mouseleave",()=>{window.hoverInfoWindow&&window.hoverInfoWindow.close()}),window.markers.push({marker:a,neighborhood:e})}),!t||window.skipAreaAnimation||window.isSingleMode||setTimeout(()=>{window.smoothFlyTo&&t.neighborhood.position&&window.smoothFlyTo(t.neighborhood.position,13),setTimeout(()=>{p(t.marker,t.neighborhood,window.infoWindow),window.activeMarker=t.marker,setTimeout(()=>{requestAnimationFrame(()=>{const e=new google.maps.LatLng(t.neighborhood.position);window.logCenteringDiagnostics&&window.logCenteringDiagnostics(e)})},100)},200)},300)},"undefined"!=typeof google&&google.maps&&l(),window.gm_authFailure=function(){const e=document.getElementById("map-placeholder");e&&(e.innerHTML='\n                    <div class="text-center">\n                        <svg class="w-16 h-16 mx-auto text-neutral-300 dark:text-neutral-600 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />\n                        </svg>\n                        <p class="text-neutral-500 dark:text-neutral-400 font-medium mb-2">Map requires local server</p>\n                        <p class="text-neutral-400 dark:text-neutral-500 text-sm mb-3">Google Maps API key is restricted to specific domains.</p>\n                        <div class="bg-neutral-200 dark:bg-neutral-800 rounded-lg p-3 text-left text-xs">\n                            <p class="text-neutral-600 dark:text-neutral-300 mb-1">To test with map, run:</p>\n                            <code class="text-brand-700 dark:text-brand-dark">cd NeighborhoodFinder && npx serve .</code>\n                            <p class="text-neutral-500 dark:text-neutral-400 mt-2">Then open: <span class="text-brand-700 dark:text-brand-dark">http://localhost:3000/tests/drawer-prototype.html</span></p>\n                        </div>\n                    </div>\n                '),console.warn("Google Maps API auth failed - likely running from file:// URL")},setTimeout(()=>{if(!window.map){const e=document.getElementById("map-placeholder");e&&e.querySelector("p").textContent.includes("Loading")&&window.gm_authFailure()}},5e3),window.initMap=l,window.testFlyTo=function(e,t,o=14){console.log("========================================"),console.log("TEST: Manual flyTo test"),console.log("========================================"),console.log("Target:",{lat:e,lng:t,zoom:o}),console.log("Map exists:",!!window.map),console.log("smoothFlyTo exists:",typeof window.smoothFlyTo),console.log("isSingleMode:",window.isSingleMode),window.map?"function"==typeof window.smoothFlyTo?(console.log("Current position:",{lat:window.map.getCenter().lat(),lng:window.map.getCenter().lng(),zoom:window.map.getZoom()}),console.log("Calling smoothFlyTo..."),window.smoothFlyTo({lat:e,lng:t},o),console.log("========================================")):console.error("FAIL: smoothFlyTo not a function"):console.error("FAIL: No map found")},window.testPostMessage=function(e,t,o="Test",n=14){console.log("========================================"),console.log("TEST: Simulating postMessage"),console.log("========================================");const i={type:"flyTo",lat:e,lng:t,neighborhoodName:o,zoom:n};console.log("Sending message:",i),window.postMessage(i,"*"),console.log("========================================")},window.diagnostics=function(){console.log("========================================"),console.log("DIAGNOSTICS: Current state"),console.log("========================================"),console.log("Map:",window.map?"EXISTS":"MISSING"),window.map&&(console.log("  Center:",{lat:window.map.getCenter().lat(),lng:window.map.getCenter().lng()}),console.log("  Zoom:",window.map.getZoom())),console.log("isSingleMode:",window.isSingleMode),console.log("smoothFlyTo:",typeof window.smoothFlyTo),console.log("markers:",window.markers?window.markers.length:"MISSING"),console.log("activeMarker:",window.activeMarker?"EXISTS":"null"),console.log("infoWindow:",window.infoWindow?"EXISTS":"MISSING");const e=[];window.map||e.push("Map not initialized"),"function"!=typeof window.smoothFlyTo&&e.push("smoothFlyTo not available"),window.CONFIG||e.push("CONFIG not loaded"),e.length>0?console.error("ISSUES FOUND:",e):console.log("âœ“ All checks passed"),console.log("========================================")};let f=null,v=0;window.addEventListener("message",e=>{if(e.data&&"object"==typeof e.data&&e.data.type&&console.log("[PostMessage] Received:",e.data.type,e.data),!e.data||"object"!=typeof e.data)return;const{type:t,lat:o,lng:n,zoom:i,neighborhoodName:r,stats:a,propertyType:s}=e.data;if("flyTo"===t&&o&&n){const e=window.map;if(!e)return void console.warn("[PostMessage] Map not ready, ignoring flyTo");const t=++v;if(console.log(`[PostMessage] Flight #${t} starting`),f&&(google.maps.event.removeListener(f),f=null,console.log("[PostMessage] Removed previous idle listener")),void 0===window.isSingleMode){const e=new URLSearchParams(window.location.search);window.isSingleMode="single"===e.get("mode"),console.log("[PostMessage] isSingleMode was undefined, set to:",window.isSingleMode)}const d={lat:o,lng:n},l=i||e.getZoom();if(console.log(`[PostMessage] Flying to ${r||"position"} at (${o.toFixed(4)}, ${n.toFixed(4)}) zoom ${l}`),console.log("[PostMessage] isSingleMode:",window.isSingleMode),window.infoWindow&&window.infoWindow.getMap()&&window.infoWindow.close(),window.activeMarker&&window.activeMarker.content){const e=window.activeMarker.isAreaMarker?m:g;window.activeMarker.content.innerHTML=e(window.activeMarker.markerColor,!1),window.activeMarker=null}window.tempMarker&&(window.tempMarker.content&&(window.tempMarker.content.innerHTML=g("#4c8f96",!1)),window.tempMarker.setMap(null),window.tempMarker=null);let c=null;if(r){console.log("[PostMessage] Creating marker for:",r);const t=document.createElement("div");t.innerHTML=g("#4c8f96",!1),c=new google.maps.marker.AdvancedMarkerElement({position:d,map:e,content:t}),window.tempMarker=c,console.log("[PostMessage] Marker created")}console.log("[PostMessage] Flying with smoothFlyTo"),window.smoothFlyTo(d,l,!1,!0),c&&google.maps.event.addListenerOnce(window.map,"idle",()=>{if(t!==v)return void console.log(`[PostMessage] Flight #${t} was superseded, aborting`);if(c!==window.tempMarker)return void console.log("[PostMessage] Marker no longer current, skipping info window");const e={name:r,position:d,propertyType:s,stats:a||{}};c.content.innerHTML=g("#4c8f96",!0),c.markerColor="#4c8f96",window.activeMarker=c,window.infoWindow||(window.infoWindow=new google.maps.InfoWindow),window.showMiniInfoWindowContent?window.showMiniInfoWindowContent(c,e,window.infoWindow):h(c,e,window.infoWindow,!0),console.log(`[PostMessage] Flight #${t} complete, info window opened`)})}});