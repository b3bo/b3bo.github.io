/**
 * @file main.js
 * @description Main application logic for Neighborhood Finder
 * @copyright 2025 Kimberly Bauman, P.A. All rights reserved.
 * 
 * This file was extracted from inline scripts in index.html
 * for better maintainability and caching.
 */
function e(){const e=window.location.search.replace(/&amp;/g,"&");return new URLSearchParams(e)}function t(){if(window.appInitialized)return;window.appInitialized=!0;const t=e(),n="single"===t.get("mode"),o=t.get("neighborhood")||t.get("marker");window.isSingleMode=n;const i=window.self!==window.top;if(n){console.log("Single mode active:",o);const e=document.getElementById("single-mode-overlay");e&&(e.style.display="flex",e.style.opacity="1",console.log("Single mode: overlay shown (early, in initApp)"))}if(i){const e=document.querySelector(".disclaimer-bar"),t=document.getElementById("map-layout");e&&(e.style.display="none"),t&&(t.style.height="100dvh")}if(!n&&window.innerWidth>=768){const e=document.getElementById("drawer-toggle");e&&(e.checked=!0)}const r=window.neighborhoods||[];window.filteredNeighborhoods,window.sortOrder,window.formatPrice;const a=document.querySelectorAll(".menu-item"),d=document.querySelectorAll(".panel-back-btn"),s=document.getElementById("main-menu");a.forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-panel"),t=document.getElementById(e+"-panel");if(t){document.querySelectorAll(".sliding-panel").forEach(e=>{e.id!==t.id&&e.classList.add("translate-x-full")}),s&&(s.style.display="none"),t.classList.remove("translate-x-full");const e=t.querySelector(".panel-back-btn");e&&setTimeout(()=>e.focus(),100)}}),e.addEventListener("keydown",function(e){const t=document.getElementById("drawer-toggle");t&&t.checked&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),window.lastFocusedMenuItem=this,this.click()))})}),d.forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation();const t=this.getAttribute("data-close-panel"),n=document.getElementById(t+"-panel");if(n){n.classList.add("translate-x-full");const e=document.getElementById("search-dropdown"),t=document.getElementById("sort-menu");e&&e.classList.add("hidden"),t&&t.classList.add("hidden"),s&&(s.style.removeProperty("display"),s.scrollTop=0,window.lastFocusedMenuItem&&setTimeout(()=>window.lastFocusedMenuItem.focus(),50))}})});const l=document.getElementById("sidebar-toggle-tab");if(l){l.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())});const e=()=>{const e=document.getElementById("drawer-toggle");l.tabIndex=e&&e.checked?-1:0};document.getElementById("drawer-toggle")?.addEventListener("change",e),e()}const c=document.getElementById("theme-toggle");c&&c.addEventListener("click",function(){document.documentElement.classList.toggle("dark");const e=document.documentElement.classList.contains("dark");if(window.map&&"undefined"!=typeof google){const t=window.map.getCenter(),n=window.map.getZoom();function o(){const e=document.querySelector(".gm-style-iw-chr");e&&e.remove()}if(window.markers,window.map=new google.maps.Map(document.getElementById("map"),{zoom:n,center:t,mapId:"92b2f4ea8b2fce54a50ed2e9",colorScheme:e?"DARK":"LIGHT",mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!0,fullscreenControl:!0,zoomControl:!0,clickableIcons:!1}),window.infoWindow=new google.maps.InfoWindow({maxWidth:320}),window.hoverInfoWindow=new google.maps.InfoWindow({maxWidth:320}),window.infoWindow.addListener("domready",o),window.hoverInfoWindow.addListener("domready",o),window.addMarkers(),window.customBoundaries&&window.customBoundaries.size>0){const i=new Set(window.customBoundaries);window.customBoundaries.clear(),i.forEach(e=>{window.showCustomBoundary(e)})}}"undefined"!=typeof gtag&&gtag("event","theme_toggle",{theme:e?"dark":"light"})});const m=document.getElementById("search-button"),w=document.getElementById("search-dropdown"),g=document.getElementById("search-input"),u=document.getElementById("sort-button"),p=document.getElementById("sort-menu");function h(e,t){if(!e||!t)return;const n=t.getBoundingClientRect(),o=window.visualViewport,i=o?o.width:window.innerWidth,r=o?o.offsetLeft:0,a=o?o.offsetTop:0;let d=r+n.left+n.width/2-140;d+280>r+i-12&&(d=r+i-280-12),d<r+12&&(d=r+12),e.style.position="fixed",e.style.top=a+n.bottom+10+"px",e.style.left=d+"px",e.style.zIndex="2147483647"}w&&document.body.appendChild(w),p&&document.body.appendChild(p),m&&w&&m.addEventListener("click",function(e){if(e.stopPropagation(),p&&p.classList.add("hidden"),w.classList.toggle("hidden"),!w.classList.contains("hidden")){h(w,m),g&&(g.value="",g.focus()),function(){const e=document.getElementById("search-results"),t=window.neighborhoods||[];if(!e||!t.length)return;const n=[...t].sort((e,t)=>(t.stats?.listingCount||0)-(e.stats?.listingCount||0)).slice(0,5);e.innerHTML=`\n                    <div class="px-4 py-2 text-xs font-medium text-neutral-400 dark:text-dark-text-secondary uppercase">Most Listings</div>\n                    ${n.map(e=>`\n                        <button class="search-result w-full text-left px-4 py-2 text-sm hover:bg-brand-100 dark:hover:bg-brand-dark/20 transition-colors cursor-pointer" data-name="${e.name}" data-type="${e.propertyType}">\n                            ${e.name} - ${e.propertyType}\n                        </button>\n                    `).join("")}\n                `}();const e=document.getElementById("search-results");e&&(e.scrollHeight>e.clientHeight+4?e.classList.add("has-overflow"):e.classList.remove("has-overflow"))}}),u&&p&&(u.addEventListener("click",function(e){if(e.stopPropagation(),w&&w.classList.add("hidden"),p.classList.toggle("hidden"),!p.classList.contains("hidden")){h(p,u);const e=p.querySelector('input[type="radio"]:checked'),t=e?e.closest(".sort-option"):p.querySelector(".sort-option");t&&setTimeout(()=>t.focus(),50)}}),u.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())})),document.addEventListener("click",function(e){!w||w.contains(e.target)||e.target===m||m.contains(e.target)||w.classList.add("hidden"),!p||p.contains(e.target)||e.target===u||u.contains(e.target)||p.classList.add("hidden")});const f=document.getElementById("sidebar"),b=document.getElementById("drawer-toggle");document.addEventListener("keydown",function(e){const t="INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName;if("Tab"===e.key&&b&&b.checked){if(w&&!w.classList.contains("hidden"))return;if(p&&!p.classList.contains("hidden")){p.classList.add("hidden");const e=document.getElementById("sort-button");e&&(e.setAttribute("aria-expanded","false"),e.removeAttribute("aria-activedescendant"))}!function(e){if(!f||!b||!b.checked)return;const t=(n=f,Array.from(n.querySelectorAll('button:not([disabled]):not([tabindex="-1"]), [href]:not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex="0"]')).filter(e=>null!==e.offsetParent&&"hidden"!==getComputedStyle(e).visibility&&!e.closest(".translate-x-full")));var n;if(0===t.length)return void e.preventDefault();e.preventDefault();const o=document.activeElement;let i,r=t.indexOf(o);-1===r&&(r=e.shiftKey?0:t.length-1),i=e.shiftKey?0===r?t.length-1:r-1:r===t.length-1?0:r+1,t[i].focus()}(e)}else{if("Escape"===e.key){w&&w.classList.add("hidden"),p&&p.classList.add("hidden"),window.infoWindow&&window.infoWindow.getMap()&&window.infoWindow.close();const e=document.querySelector(".sliding-panel:not(.translate-x-full)");if(e)return e.classList.add("translate-x-full"),void(s&&(s.style.removeProperty("display"),s.scrollTop=0,window.lastFocusedMenuItem&&setTimeout(()=>window.lastFocusedMenuItem.focus(),50)));const t=document.getElementById("drawer-toggle");if(t&&t.checked){t.checked=!1,t.dispatchEvent(new Event("change",{bubbles:!0})),window.lastFocusedMenuItem=null;const e=document.getElementById("sidebar-toggle-tab");e&&setTimeout(()=>e.focus(),50)}}if(!t&&("ArrowDown"===e.key||"ArrowUp"===e.key)){const t=document.activeElement?.closest(".menu-item");if(t){e.preventDefault();const n=Array.from(document.querySelectorAll(".menu-item")),o=n.indexOf(t);let i;return i="ArrowDown"===e.key?(o+1)%n.length:0===o?n.length-1:o-1,void n[i].focus()}const n=document.activeElement?.closest(".sort-option");if(n){e.preventDefault();const t=Array.from(document.querySelectorAll(".sort-option")),o=t.indexOf(n);let i;return i="ArrowDown"===e.key?(o+1)%t.length:0===o?t.length-1:o-1,void t[i].focus()}}if(!t&&("Enter"===e.key||" "===e.key)){const t=document.activeElement?.closest(".sort-option");if(t){e.preventDefault();const n=t.querySelector('input[type="radio"]');n&&(n.checked=!0,n.dispatchEvent(new Event("change",{bubbles:!0})))}}if(!t&&("ArrowLeft"===e.key||"ArrowRight"===e.key)){const t=document.activeElement?.closest('[role="group"]');if(t){e.preventDefault();const n=Array.from(t.querySelectorAll("button:not([disabled])")),o=n.indexOf(document.activeElement);if(-1!==o){let t;t="ArrowRight"===e.key?(o+1)%n.length:0===o?n.length-1:o-1,n[t].focus()}return}}if(!t&&("ArrowUp"===e.key||"ArrowDown"===e.key)){const t=document.activeElement?.closest('[role="group"]');if(t){e.preventDefault();const n=Array.from(t.querySelectorAll("button:not([disabled])")),o=document.activeElement,i=o.getBoundingClientRect(),r=i.left+i.width/2;let a=n.filter(t=>{if(t===o)return!1;const n=t.getBoundingClientRect();return"ArrowDown"===e.key?n.top>i.bottom-5:n.bottom<i.top+5});return void(a.length>0&&(a.sort((t,n)=>{const o=t.getBoundingClientRect(),i=n.getBoundingClientRect(),a=o.left+o.width/2,d=i.left+i.width/2,s=Math.abs(a-r),l=Math.abs(d-r),c="ArrowDown"===e.key?o.top:-o.bottom,m="ArrowDown"===e.key?i.top:-i.bottom;return Math.abs(c-m)>10?c-m:s-l}),a[0].focus()))}}!t&&window.infoWindow&&window.infoWindow.getMap()&&("ArrowLeft"===e.key?(e.preventDefault(),window.navigateNeighborhood(-1)):"ArrowRight"===e.key&&(e.preventDefault(),window.navigateNeighborhood(1)))}}),g&&g.addEventListener("keydown",function(e){("Enter"===e.key||"Escape"===e.key)&&(e.preventDefault(),w.classList.add("hidden"),g.blur())}),["resize","orientationchange"].forEach(e=>{window.addEventListener(e,()=>{w&&!w.classList.contains("hidden")&&h(w,m),p&&!p.classList.contains("hidden")&&h(p,u)})}),window.addEventListener("scroll",()=>{w&&!w.classList.contains("hidden")&&h(w,m),p&&!p.classList.contains("hidden")&&h(p,u)},!0),window.visualViewport&&["resize","scroll"].forEach(e=>{window.visualViewport.addEventListener(e,()=>{w&&!w.classList.contains("hidden")&&h(w,m),p&&!p.classList.contains("hidden")&&h(p,u)})}),g&&g.addEventListener("blur",()=>{setTimeout(()=>{window.scrollTo(0,0),document.documentElement.scrollLeft=0,document.body.scrollLeft=0},100)});let v=null,k=null;function y(){const e=window.filterState||{},t=(window.neighborhoods||[]).length;return(window.filteredNeighborhoods||[]).length<t||!!window.searchQuery||!!e.propertyType||!!(e.areas&&e.areas.size>0)||!!(e.amenities&&e.amenities.size>0)||e.priceMin>0||e.priceMax<41||e.bedsMin>1||e.bathsMin>1}function x(){const e=document.getElementById("neighborhoodList"),t=document.getElementById("resultsCount");if(!e)return;const n=window.filteredNeighborhoods||[],o=window.sortOrder||"listings-desc",i=[...n].sort((e,t)=>{const n=e.stats?.medianPrice||e.stats?.avgPrice||0,i=t.stats?.medianPrice||t.stats?.avgPrice||0,r=e.stats?.listingCount||0,a=t.stats?.listingCount||0;switch(o){case"name-asc":default:return e.name.localeCompare(t.name);case"name-desc":return t.name.localeCompare(e.name);case"price-asc":return n-i;case"price-desc":return i-n;case"listings-desc":return a-r}});if(t){const e=i.length,n=1===e?" Community":" Communities",o=y()?' <button id="clear-filters" class="ml-2 px-3 py-1 text-sm font-medium rounded-lg border border-neutral-300 dark:border-dark-border bg-white dark:bg-dark-bg-elevated text-neutral-700 dark:text-dark-text-primary hover:bg-brand-100 dark:hover:bg-brand-dark/20 hover:text-brand-700 dark:hover:text-brand-dark transition-colors">Clear</button>':"";if(t.innerHTML=`<span class="count-number">${null!==v?v:e}</span>${n}${o}`,function(e,t,n=700){k&&(cancelAnimationFrame(k),k=null);const o=e.querySelector(".count-number"),i=o?parseInt(o.textContent,10):null,r=null===i||isNaN(i)?null!==v?v:t:i,a=t-r;if(0===a||null===v)return v=t,void(o&&(o.textContent=t));const d=performance.now();k=requestAnimationFrame(function e(i){const s=i-d,l=Math.min(s/n,1),c=1-Math.pow(1-l,3),m=Math.round(r+a*c);o&&(o.textContent=m),l<1?k=requestAnimationFrame(e):(k=null,v=t)})}(t,e),y()){const e=document.getElementById("clear-filters");e&&e.addEventListener("click",e=>{e.stopPropagation(),function(){window.filterState={propertyType:null,areas:new Set,amenities:new Set,priceMin:0,priceMax:41,bedsMin:1,bathsMin:1},window.searchQuery="";const e=document.getElementById("search-input");e&&(e.value="");const t=document.getElementById("price-min"),n=document.getElementById("price-max");t&&(t.value=0),n&&(n.value=41);const o=document.getElementById("beds-slider"),i=document.getElementById("baths-slider");o&&(o.value=1),i&&(i.value=1),document.querySelectorAll("[data-filter-type]").forEach(e=>{e.classList.remove("bg-brand-600","text-white"),e.classList.add("bg-white","text-neutral-700")}),document.querySelectorAll(".area-tag").forEach(e=>{e.classList.remove("selected")}),window.areaMarkers&&window.areaMarkers.forEach((e,t)=>{window.hideAreaMarker&&window.hideAreaMarker(t)}),document.querySelectorAll("input[data-amenity]").forEach(e=>{e.checked=!1}),document.querySelectorAll(".amenity-tag").forEach(e=>{e.classList.remove("selected")}),window.customBoundaries&&window.hideCustomBoundary&&[...window.customBoundaries].forEach(e=>{window.hideCustomBoundary(e)}),window.filteredNeighborhoods=[...window.neighborhoods||[]],x(),window.addMarkers&&window.addMarkers();const r=document.getElementById("price-display");r&&(r.textContent="$250K - $35M+");const a=document.getElementById("beds-display"),d=document.getElementById("baths-display");a&&(a.textContent="1+"),d&&(d.textContent="1+"),"undefined"!=typeof gtag&&gtag("event","clear_filters")}()})}}const r=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M");e.innerHTML=i.map(e=>`\n                    <button type="button" class="neighborhood-item w-full text-left bg-white dark:bg-dark-bg-elevated px-4 py-3 rounded-xl border border-neutral-200 dark:border-dark-border cursor-pointer overflow-hidden transition-colors hover:bg-brand-100 dark:hover:bg-brand-dark/20 active:bg-brand-200 dark:active:bg-brand-dark/30"\n                         data-name="${e.name}" data-type="${e.propertyType}">\n                        <div class="flex justify-between items-start gap-2 mb-1">\n                            <h3 class="text-base font-semibold text-neutral-800 dark:text-dark-text-primary break-words">${e.name}</h3>\n                            <span class="text-sm font-semibold text-neutral-800 dark:text-dark-text-primary whitespace-nowrap">${r(e.stats?.medianPrice||e.stats?.avgPrice||0)}</span>\n                        </div>\n                        <div class="text-xs text-neutral-600 dark:text-dark-text-secondary mb-3">${e.stats?.listingCount||0} ${function(e){const t=(e||"").toLowerCase();return t.includes("townhome")?"Active T/H Listings":t.includes("condo")?"Active Condo Listings":t.includes("home")?"Active Home Listings":"Active Listings"}(e.propertyType)}</div>\n                        <div class="text-xs text-neutral-600 dark:text-dark-text-secondary leading-relaxed break-words">${function(e){if(!e||0===e.length)return"No amenities listed";const t=window.filterState?.amenities||new Set;return e.map(e=>t.has(e)?`<strong>${e}</strong>`:e).join(", ")+"."}(e.amenities||[])}</div>\n                    </button>\n                `).join(""),e.querySelectorAll(".neighborhood-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.name,n=e.dataset.type,o=(window.filteredNeighborhoods||[]).find(e=>e.name===t&&e.propertyType===n);if(o&&window.map){"undefined"!=typeof gtag&&gtag("event","select_neighborhood",{neighborhood_name:o.name,listing_count:o.stats?.listingCount||0,price:r(o.stats?.medianPrice||o.stats?.avgPrice||0)}),window.smoothFlyTo(o.position);const e=(window.markers||[]).find(e=>e.neighborhood.name===t&&e.neighborhood.propertyType===n);if(e){const t=window.map.getCenter(),n=new google.maps.LatLng(o.position),i=google.maps.geometry.spherical.computeDistanceBetween(t,n);setTimeout(()=>{google.maps.event.trigger(e.marker,"click")},i<2e3?450:2200)}}})})}window.PRICE_STEPS=window.PRICE_STEPS||[25e4,3e5,35e4,4e5,45e4,5e5,55e4,6e5,65e4,7e5,75e4,8e5,85e4,9e5,95e4,1e6,125e4,15e5,175e4,2e6,225e4,25e5,275e4,3e6,325e4,35e5,375e4,4e6,425e4,45e5,475e4,5e6,6e6,7e6,8e6,9e6,1e7,15e6,2e7,25e6,3e7,35e6];const L=window.PRICE_STEPS;window.filterState={propertyType:null,areas:new Set,amenities:new Set,priceMin:0,priceMax:41};const M=document.getElementById("price-min"),E=document.getElementById("price-max"),I=document.getElementById("price-display"),S=document.getElementById("price-fill");function T(e){return e>=1e6?"$"+(e/1e6).toFixed(e%1e6==0?0:1)+"M":"$"+(e/1e3).toFixed(0)+"K"}function C(){if(!M||!E)return;let e=parseInt(M.value)||0,t=parseInt(E.value)||41;if(e>t&&(this===E?(M.value=t,e=t):(E.value=e,t=e)),window.filterState.priceMin=e,window.filterState.priceMax=t,I)if(0===e&&0===t)I.textContent="$250K - $35M+";else{const n=L[e]||L[0],o=L[t]||L[L.length-1];I.textContent=`${T(n)} - ${T(o)}${41===t?"+":""}`}if(S){const n=e/41,o=t/41;0===e?(S.style.left="0",S.style.width=100*o+"%"):(S.style.left=100*n+"%",S.style.width=100*(o-n)+"%")}q()}M&&M.addEventListener("input",C),E&&E.addEventListener("input",C);const A=document.getElementById("beds-min"),B=document.getElementById("beds-display"),$=document.getElementById("beds-fill"),P=document.getElementById("baths-min"),N=document.getElementById("baths-display"),W=document.getElementById("baths-fill");window.filterState.bedsMin=1,window.filterState.bathsMin=1,A&&A.addEventListener("input",function(){if(!A)return;const e=parseInt(A.value)||1;if(window.filterState.bedsMin=e,B&&(B.textContent=e>=6?"6+":`${e}+`),$){const t=(e-1)/5*100;$.style.width=`${t}%`}q()}),P&&P.addEventListener("input",function(){if(!P)return;const e=parseInt(P.value)||1;if(window.filterState.bathsMin=e,N&&(N.textContent=e>=6?"6+":`${e}+`),W){const t=(e-1)/5*100;W.style.width=`${t}%`}q()});const O=document.getElementById("btn-homes"),_=document.getElementById("btn-condos");O&&O.addEventListener("click",function(){this.classList.toggle("active"),q()}),_&&_.addEventListener("click",function(){this.classList.toggle("active"),q()}),document.querySelectorAll(".area-tag").forEach(e=>{e.addEventListener("click",function(){this.classList.toggle("selected");const e=this.getAttribute("data-zipcode"),t=this.getAttribute("data-subarea"),n=this.classList.contains("selected");e&&(n?(window.filterState.areas.add(e),window.showCustomBoundary(e)):(window.filterState.areas.delete(e),window.hideCustomBoundary(e)),"undefined"!=typeof gtag&&gtag("event","filter_area",{area:e,action:n?"selected":"deselected"})),t&&(n?window.filterState.areas.add(t):window.filterState.areas.delete(t),"undefined"!=typeof gtag&&gtag("event","filter_subarea",{subarea:t,action:n?"selected":"deselected"})),q();const o=window.areaPresets?.presets?.find(n=>e&&n.filterValue===e||t&&n.filterValue===t);o&&window.showAreaMarker&&window.hideAreaMarker&&(n?window.showAreaMarker(o):window.hideAreaMarker(o.slug))})}),document.querySelectorAll(".amenity-tag").forEach(e=>{e.addEventListener("click",function(){this.classList.toggle("selected");const e=this.getAttribute("data-amenity"),t=this.classList.contains("selected");e&&(t?(window.filterState.amenities.add(e),"Short-Term"===e?(window.filterState.amenities.delete("No Short-Term"),document.querySelector('.amenity-tag[data-amenity="No Short-Term"]')?.classList.remove("selected")):"No Short-Term"===e&&(window.filterState.amenities.delete("Short-Term"),document.querySelector('.amenity-tag[data-amenity="Short-Term"]')?.classList.remove("selected"))):window.filterState.amenities.delete(e),"undefined"!=typeof gtag&&gtag("event","filter_amenity",{amenity:e,action:t?"selected":"deselected"})),q()})});const F=e().get("subarea");if(F){const e=Array.from(document.querySelectorAll(".area-tag")).find(e=>e.getAttribute("data-subarea")===F);e&&e.click()}function q(){const e=!!O&&O.classList.contains("active"),t=!!_&&_.classList.contains("active"),n=window.filterState.areas,o=window.filterState.amenities,i=window.filterState.priceMin||0,r=window.filterState.priceMax||41,a=window.filterState.bedsMin||1,d=window.filterState.bathsMin||1;let s=0===i?0:L[i]||0,l=r>=41?Number.MAX_SAFE_INTEGER:L[r]||Number.MAX_SAFE_INTEGER;window.filteredNeighborhoods=(window.neighborhoods||[]).filter(i=>{let r=!0;if(e||t){r=!1;const n=(i.propertyType||"").toLowerCase();!e||"homes"!==n&&"townhomes"!==n||(r=!0),t&&"condos"===n&&(r=!0)}let c=!0;n.size>0&&(c=n.has(i.zipCode)||n.has(i.area)||n.has(i.subArea));let m=!0;o.size>0&&(m=[...o].every(e=>i.amenities&&i.amenities.includes(e)));let w=!0;const g=i.stats||{},u=void 0!==g.minPrice?parseFloat(g.minPrice):null,p=void 0!==g.maxPrice?parseFloat(g.maxPrice):null;null===u||null===p||isNaN(u)||isNaN(p)?g.avgPrice>0&&(w=g.avgPrice>=s&&g.avgPrice<=l):w=l>=u&&s<=p;let h=!0;if(a>1){const e=void 0!==g.maxBeds?parseFloat(g.maxBeds):null;null===e||isNaN(e)||(h=e>=a)}let f=!0;if(d>1){const e=void 0!==g.maxBaths?parseFloat(g.maxBaths):null;null===e||isNaN(e)||(f=e>=d)}return r&&c&&m&&w&&h&&f}),x(),window.addMarkers(),window.fitBoundsToNeighborhoods()}window.findAreaButton=function(e){if(!e)return null;const{filterField:t,filterValue:n}=e;return"zipCode"===t?document.querySelector(`.area-tag[data-zipcode="${n}"]`):document.querySelector(`.area-tag[data-subarea="${n}"]`)},window.createAreaMarkerData=function(e){return{name:e.name,position:e.position,stats:e.stats,neighborhoods:e.neighborhoods,filterField:e.filterField,filterValue:e.filterValue,isAreaMarker:!0}},document.querySelectorAll('input[name="sort"]').forEach(e=>{e.addEventListener("change",e=>{window.sortOrder=e.target.value,x(),p&&p.classList.add("hidden")})});let H=null;g&&g.addEventListener("input",e=>{const t=e.target.value.trim(),n=t.toLowerCase(),o=document.getElementById("search-results"),i=e=>{if(!t)return e;const n=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`(${o})`,"ig");return n.replace(i,"<strong>$1</strong>")};if(n&&"undefined"!=typeof gtag&&(clearTimeout(H),H=setTimeout(()=>{gtag("event","search_filter",{search_term:n})},500)),n){const e=r.filter(e=>e.name.toLowerCase().includes(n)||(e.location?.city||"").toLowerCase().includes(n)||(e.zipCode||"").includes(n)).sort((e,t)=>{const o=e.name.toLowerCase().includes(n)?0:1,i=t.name.toLowerCase().includes(n)?0:1;return o!==i?o-i:e.name.localeCompare(t.name)});e.length?o.innerHTML=e.map(e=>`\n                                <button class="search-result w-full text-left px-4 py-2 text-sm hover:bg-brand-100 dark:hover:bg-brand-dark/20 transition-colors cursor-pointer" data-name="${e.name}" data-type="${e.propertyType}">\n                                    ${i(e.name)} - ${i(e.propertyType)}\n                                </button>\n                            `).join(""):o.innerHTML='<div class="px-4 py-3 text-sm text-neutral-400">No matches found</div>'}else{const e=[...r].sort((e,t)=>(t.stats?.listingCount||0)-(e.stats?.listingCount||0)).slice(0,5);o.innerHTML=`\n                            <div class="px-4 py-2 text-xs font-medium text-neutral-400 dark:text-dark-text-secondary uppercase">Most Listings</div>\n                            ${e.map(e=>`\n                                <button class="search-result w-full text-left px-4 py-2 text-sm hover:bg-brand-100 dark:hover:bg-brand-dark/20 transition-colors cursor-pointer" data-name="${e.name}" data-type="${e.propertyType}">\n                                    ${e.name} - ${e.propertyType}\n                                </button>\n                            `).join("")}\n                        `}const a=document.getElementById("search-results");a&&a.scrollHeight>a.clientHeight+4?a.classList.add("has-overflow"):a&&a.classList.remove("has-overflow"),window.searchQuery=n,window.filteredNeighborhoods=n?(window.neighborhoods||[]).filter(e=>e.name.toLowerCase().includes(n)):[...window.neighborhoods||[]],x(),window.addMarkers&&window.addMarkers()});const D=document.getElementById("search-results");if(D&&D.addEventListener("click",function(e){const t=e.target.closest(".search-result");if(!t)return;const n=t.dataset.name,o=t.dataset.type,i=(window.neighborhoods||[]).find(e=>e.name===n&&e.propertyType===o);if(i&&window.map){"undefined"!=typeof gtag&&gtag("event","search_select",{neighborhood_name:i.name,search_query:g?.value||""}),window.smoothFlyTo(i.position);const e=(window.markers||[]).find(e=>e.neighborhood.name===n&&e.neighborhood.propertyType===o);if(e){const t=window.map.getCenter(),n=new google.maps.LatLng(i.position),o=google.maps.geometry.spherical.computeDistanceBetween(t,n);setTimeout(()=>{google.maps.event.trigger(e.marker,"click")},o<2e3?450:2200)}}w&&w.classList.add("hidden"),g&&(g.value=""),window.searchQuery="",window.filteredNeighborhoods=[...window.neighborhoods||[]],x(),window.addMarkers&&window.addMarkers()}),x(),window.visualViewport){const e=()=>{const e=document.getElementById("sort-menu"),t=document.getElementById("search-dropdown");if(e&&!e.classList.contains("hidden")&&(e.classList.add("hidden"),setTimeout(()=>e.classList.remove("hidden"),10)),t&&!t.classList.contains("hidden")){const e=document.getElementById("search-input");document.activeElement!==e&&t.classList.add("hidden")}};window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)}}window.addEventListener("dataLoaded",t),document.addEventListener("DOMContentLoaded",()=>{window.neighborhoods&&window.neighborhoods.length>0&&t()});let n=null,o=!1;function i(){const e=document.getElementById("single-mode-overlay");e&&(e.style.opacity="0",setTimeout(()=>{e.style.display="none",console.log("Single mode: overlay hidden")},300))}function r(e,t=0,a=!1){const d=window.map;if(!d||!e)return;const s=document.querySelector(".gm-style-iw-c");if(!s)return t<20?requestAnimationFrame(()=>r(e,t+1,a)):void 0;o&&!n&&(n=new ResizeObserver(()=>{r(e,999,!1)}),n.observe(s));const l=s.getBoundingClientRect().height,c=document.getElementById("map")||d.getDiv(),m=c?.getBoundingClientRect?.().height||c?.offsetHeight||window.innerHeight,w=m>=450&&l+78+10<m-40?Math.round((l+78-10)/2):Math.round(Math.max(0,20+l+78+10-m/2)),g=d.getZoom(),u=function(e,t,n){const o=Math.pow(2,n),i=e*Math.PI/180,r=Math.log(Math.tan(Math.PI/4+i/2))+t/(256*o/(2*Math.PI));return 180*(2*Math.atan(Math.exp(r))-Math.PI/2)/Math.PI}(e.lat(),w,g);console.log("Single mode: applying setCenter, isInitial:",a),d.setCenter({lat:u,lng:e.lng()}),window.singleModeOffsetApplied=!0,a&&!o&&google.maps.event.addListenerOnce(d,"idle",()=>{console.log("Single mode: map idle after initial centering"),o=!0,i(),setTimeout(()=>{window.logCenteringDiagnostics&&window.logCenteringDiagnostics(e)},500),n||(n=new ResizeObserver(()=>{r(e,999,!1)}),n.observe(s))})}function a(e,t=0){const n=function(e,t=!1){const n=document.getElementById("map"),o=n?.offsetWidth||window.innerWidth,i=n?.offsetHeight||window.innerHeight,r=o<640?450:o<1024?380:340,a=t?r+70:r;if(i>=450&&a+78+10<i-40)return Math.round((a+78-10)/2);{const e=20+a+78+10;return Math.round(Math.max(0,e-i/2))}}(0,!1);return Math.round(n+t/2)}function d(e,t,n){const o=window.map,i=Math.pow(2,n||o.getZoom()),r=o.getProjection().fromLatLngToPoint(new google.maps.LatLng(e)),a=new google.maps.Point(0,-t/i),d=new google.maps.Point(r.x,r.y+a.y),s=o.getProjection().fromPointToLatLng(d);return console.log("offsetLatLng:",{inputLat:e.lat,offsetPx:t,zoom:n,scale:i,outputLat:s.lat(),latDiff:s.lat()-e.lat}),{lat:s.lat(),lng:e.lng}}window.customBoundaries=new Set,window.showCustomBoundary=function(e){window.map&&!window.customBoundaries.has(e)&&(window.customBoundaries.add(e),window.map.data.loadGeoJson(`./neighborhoods/jsons/${e}.geojson`,{idPropertyName:"ZCTA5CE20"},function(e){window.map.data.setStyle(function(e){const t=e.getProperty("ZCTA5CE20")||e.getProperty("ZCTA5CE10");if(window.customBoundaries.has(t)){const e=document.documentElement.classList.contains("dark")?"#5ba3ab":"#4c8f96";return{strokeColor:e,strokeWeight:1.5,strokeOpacity:.35,fillColor:e,fillOpacity:.15,clickable:!1}}return{visible:!1}})}))},window.hideCustomBoundary=function(e){window.map&&window.customBoundaries.has(e)&&(window.customBoundaries.delete(e),window.map.data.forEach(function(t){(t.getProperty("ZCTA5CE20")||t.getProperty("ZCTA5CE10"))===e&&window.map.data.remove(t)}))},window.fitBoundsToNeighborhoods=function(e=0){const t=window.map,n=window.filteredNeighborhoods||[];if(!t||0===n.length)return;const o=new google.maps.LatLngBounds;if(n.forEach(e=>{e.position&&o.extend(new google.maps.LatLng(e.position))}),!o.isEmpty()){const n=window.innerWidth<768?50:150;t.setOptions({maxZoom:15}),t.fitBounds(o,{top:50,right:n,bottom:60,left:n});const i=google.maps.event.addListener(t,"idle",()=>{if(t.setOptions({maxZoom:22}),!window.skipZoomAdjust){const n=t.getZoom();e>0&&n<e&&t.setZoom(e)}google.maps.event.removeListener(i)})}},window.smoothFlyTo=function(e,t){const n=window.map;if(!n)return;const o=window.CONFIG?.map||{};void 0===t&&(t=o.defaultZoom||14);const i=n.getCenter(),r=n.getZoom(),s=new google.maps.LatLng(e),l=d(e,a(0,40),t),c=a(0,40),m=d({lat:i.lat(),lng:i.lng()},-c,r),w=new google.maps.LatLng(m),g=google.maps.geometry.spherical.computeDistanceBetween(w,s),u=o.flightZoomArc||{},p=o.flightDuration||{},h=performance.now();let f,b,v;f=g<1e3?p.micro||800:g<2e3?p.short||1200:p.medium||2e3,g<(u.micro?.maxDistance||2e3)?(b=u.micro?.minZoom||13,v="micro"):g<(u.short?.maxDistance||5e3)?(b=u.short?.minZoom||13,v="short"):g<(u.medium?.maxDistance||2e4)?(b=u.medium?.minZoom||12,v="med"):(b=u.long?.minZoom||10,v="long"),b=r>=t?Math.min(b,r-1,t-1):r,console.log(`Flight: ${v} | ${(g/1e3).toFixed(2)}km | minZoom=${b}`),requestAnimationFrame(function e(o){const a=o-h,d=Math.min(a/f,1),s=d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,c=i.lat()+(l.lat-i.lat())*s,m=i.lng()+(l.lng-i.lng())*s;let w;if(d<.5){const e=2*d,t=1-Math.pow(1-e,2);w=r+(b-r)*t}else{const e=2*(d-.5);w=b+e*e*(t-b)}n.moveCamera({center:{lat:c,lng:m},zoom:w}),d<1&&requestAnimationFrame(e)})},window.navigateNeighborhood=function(e){const t=window.filteredNeighborhoods||[];if(t.length<1)return;console.log("[Nav Debug] filteredNeighborhoods count:",t.length,"first 3:",t.slice(0,3).map(e=>e.name));const n=window.sortOrder||"listings-desc",o=[...t].sort((e,t)=>{const o=e.stats?.medianPrice||e.stats?.avgPrice||0,i=t.stats?.medianPrice||t.stats?.avgPrice||0,r=e.stats?.listingCount||0,a=t.stats?.listingCount||0;switch(n){case"name-asc":default:return e.name.localeCompare(t.name);case"name-desc":return t.name.localeCompare(e.name);case"price-asc":return o-i;case"price-desc":return i-o;case"listings-desc":return a-r}}),i=window.currentNeighborhood;let r,a=-1;i&&!i.isAreaMarker&&(a=o.findIndex(e=>e.name===i.name&&e.propertyType===i.propertyType)),-1===a?r=1===e?0:o.length-1:(r=a+e,r<0&&(r=o.length-1),r>=o.length&&(r=0));const d=o[r];if(!d)return;console.log("[Nav Debug] navigating to:",d.name,"position:",d.position,"index:",r,"of",o.length);const l=(window.markers||[]).find(e=>e.neighborhood.name===d.name&&e.neighborhood.propertyType===d.propertyType);if(l&&l.marker){const t=-1===e?"nav-prev":"nav-next",n=document.getElementById(t);n&&n.classList.add("bg-brand-100","dark:bg-brand-dark/20"),setTimeout(()=>{window.infoWindow&&window.infoWindow.getMap()&&window.infoWindow.close(),window.activeMarker&&window.activeMarker.content&&(window.activeMarker.content.innerHTML=s(window.activeMarker.markerColor,!1),window.activeMarker=null),window.smoothFlyTo(d.position,window.map.getZoom());const e=window.map.getCenter(),t=new google.maps.LatLng(d.position),n=google.maps.geometry.spherical.computeDistanceBetween(e,t);setTimeout(()=>{google.maps.event.trigger(l.marker,"click")},n<2e3?450:2200)},150)}};function s(e,t=!1){const n=t?44:32,o=t?10:6;return`\n                <svg width="${n}" height="${n}" viewBox="0 0 ${n} ${n}" xmlns="http://www.w3.org/2000/svg">\n                    ${t?`\n                        <circle cx="${n/2}" cy="${n/2}" r="${o}"\n                            fill="none"\n                            stroke="${e}"\n                            stroke-width="4"\n                            opacity="0.7">\n                            <animate attributeName="r"\n                                from="${o}"\n                                to="${n/2-2}"\n                                dur="1.5s"\n                                repeatCount="indefinite"/>\n                            <animate attributeName="opacity"\n                                from="0.7"\n                                to="0"\n                                dur="1.5s"\n                                repeatCount="indefinite"/>\n                        </circle>\n                    `:""}\n                    <circle cx="${n/2}" cy="${n/2}" r="${o}"\n                        fill="${e}"\n                        stroke="white"\n                        stroke-opacity="0.75"\n                        stroke-width="${t?3:2}"/>\n                </svg>\n            `}function l(e,t,n){const o=t.stats||{},i=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M"),r=(t.neighborhoods||[]).slice(0,10).map(e=>e.name).join(", "),a=`\n                <div class="info-window p-2 sm:p-3 max-w-sm bg-white dark:bg-dark-bg-elevated">\n                    <h3 class="text-base sm:text-lg font-semibold text-neutral-800 dark:text-dark-text-primary mb-2 text-center">${t.name}</h3>\n                    <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary">${o.listingCount||0}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Active Listings</div>\n                        </div>\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary">${i(o.medianPrice||0)}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Median Price</div>\n                        </div>\n                    </div>\n                    <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary">$${(o.avgPricePerSqFt||0).toLocaleString()}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg $/Sq Ft</div>\n                        </div>\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary">${o.avgDom||0}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg DOM</div>\n                        </div>\n                    </div>\n                    <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 p-2 sm:p-3 rounded-lg border border-neutral-200 dark:border-dark-border mb-2 sm:mb-3">\n                        <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-1">Top Communities</div>\n                        <div class="communities-scroll text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">${r}</div>\n                    </div>\n                    <hr class="divider mb-2 sm:mb-3">\n                    <div class="pt-2 sm:pt-3 flex items-center gap-1.5 sm:gap-2">\n                        ${(()=>{const e=(window.filteredNeighborhoods||[]).length>1,n=e?'<button id="nav-prev" onclick="window.navigateNeighborhood(-1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Previous Community"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button>':"",o=e?'<button id="nav-next" onclick="window.navigateNeighborhood(1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Next Community"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></button>':"";if(window.isSingleMode)return n+'<a href="'+("localhost"===window.location.hostname?window.location.origin:"https://neighborhoods.truesouthcoastalhomes.com")+"?marker="+t.name.toLowerCase().replace(/[^a-z0-9]+/g,"-")+'" target="_blank" class="flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors" title="Open '+t.name+' in Neighborhood Finder">Neighborhood Finder&trade; <svg style="display:inline;width:1.1em;height:1.1em;vertical-align:middle;margin-left:2px" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg></a>'+o;{const e=(window.areaPresets?.presets||[]).find(e=>e.name===t.name);return n+'<a href="https://www.truesouthcoastalhomes.com/property-search/results/?searchtype=3#listtype_1/'+(e?.listingsParam||"area_"+encodeURIComponent(t.name)+"/")+'" target="_blank" class="flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors" onclick="event.stopPropagation();" title="View all '+t.name+' listings">Matching Listings</a>'+o}})()}\n                    </div>\n                </div>\n            `;n.setContent(a),n.open(window.map,e),google.maps.event.addListenerOnce(n,"domready",()=>{const e=document.querySelector(".communities-scroll");e&&e.scrollHeight>e.clientHeight+4&&e.classList.add("has-overflow")})}function c(e,t,n,o=!0){if(t.isAreaMarker)return l(e,t,n);o&&n===window.infoWindow&&(window.currentNeighborhood=t);const i=window.formatPrice||(e=>"$"+(e/1e6).toFixed(1)+"M"),r=t.stats||{},a=i(r.medianPrice||r.avgPrice||0),d=r.avgPricePerSqFt||(r.avgSqft>0?Math.round((r.avgPrice||0)/r.avgSqft):0),c=(()=>{const e=(t.propertyType||"").toLowerCase();return e.includes("townhome")?"Active T/H Listings":e.includes("condo")?"Active Condo Listings":e.includes("home")?"Active Home Listings":"Active Listings"})(),m=window.filterState&&window.filterState.amenities?window.filterState.amenities:new Set,w=(t.propertyType||"homes").toLowerCase(),g=window.filterState||{},u=g.bedsMin||1,p=g.bathsMin||1,h=g.priceMin>0?window.PRICE_STEPS[g.priceMin]:null,f=g.priceMax<41?window.PRICE_STEPS[g.priceMax]:null,b=u>1?`beds_${u}/`:"",v=p>1?`baths_${p}/`:"",k=h?`lprice_${h}/`:"",y=f&&f<35e6?`uprice_${f}/`:"";let x="";x=w.includes("townhome")?"listtypedescrip_attached%20single%20unit/":w.includes("condo")?"listtypedescrip_condominium/":w.includes("lot")||w.includes("land")||w.includes("vacant")?"":"listtypedescrip_detached%20single%20family/";let L="listtype_1";(w.includes("lot")||w.includes("land")||w.includes("vacant"))&&(L="listtype_4");const M=`#${L}/${k}${y}${b}${v}${x}`;let E;E=t.mlsSubdivisions&&t.mlsSubdivisions.length>0?`subdivision=${t.mlsSubdivisions.map(e=>e.replace(/ /g,"+")).join(",")}`:`subdivision=${t.name.replace(/ /g,"+")}`;const I=`https://www.truesouthcoastalhomes.com/property-search/results/?searchtype=3&${E}${M}`,S=(window.filteredNeighborhoods||[]).length>1,T=`\n                <div class="info-window p-2 sm:p-3 max-w-sm bg-white dark:bg-dark-bg-elevated" style="cursor: pointer;" tabindex="-1">\n                    <div class="flex items-center justify-center gap-2 mb-2">\n                        <h3 class="text-base sm:text-lg font-semibold text-neutral-800 dark:text-dark-text-primary">${t.name}</h3>\n                        ${t.urlSlug?`\n                        <a href="https://www.truesouthcoastalhomes.com${t.urlSlug}"\n                           target="_blank"\n                           class="text-brand-500 dark:text-brand-dark hover:text-brand-600 dark:hover:text-brand-dark-hover transition-colors focus-ring rounded"\n                           onclick="event.stopPropagation();"\n                           title="${t.name} ${t.propertyType} for Sale">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>\n                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>\n                            </svg>\n                        </a>\n                        `:""}\n                    </div>\n                    <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">${r.listingCount||0}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">${c}</div>\n                        </div>\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">${a}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Med List Price</div>\n                        </div>\n                    </div>\n                    <div class="grid grid-cols-2 gap-1.5 sm:gap-2 mb-2">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">$${d.toLocaleString()}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg $/Sq Ft</div>\n                        </div>\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-0.5">${r.avgDom||0}</div>\n                            <div class="text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary">Avg DOM</div>\n                        </div>\n                    </div>\n                    ${(t.amenities||[]).length>0?`\n                    <div class="mb-2 sm:mb-3">\n                        <div class="bg-neutral-50 dark:bg-dark-bg-elevated-2 p-2 sm:p-3 rounded-lg border border-neutral-200 dark:border-dark-border">\n                            <div class="text-xs sm:text-sm font-semibold text-neutral-800 dark:text-dark-text-primary mb-1">Amenities</div>\n                            <div class="amenities-scroll text-[10px] sm:text-xs text-neutral-600 dark:text-dark-text-secondary leading-tight">${((e=[])=>e.map(e=>{const t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return m.has(e)?`<strong>${t}</strong>`:t}).join(", ")+".")(t.amenities||[])}</div>\n                        </div>\n                    </div>\n                    `:""}\n                    <hr class="divider mb-2 sm:mb-3">\n                    <div class="pt-2 sm:pt-3 flex items-center gap-1.5 sm:gap-2">\n                        ${S?'\n                        <button id="nav-prev" onclick="window.navigateNeighborhood(-1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Previous Community">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>\n                        </button>\n                        ':""}\n                        ${(()=>{if(window.isSingleMode){const e=window.toSlug(t.name),n=t.propertyType?"&propertyType="+encodeURIComponent(t.propertyType):"";return'<a href="'+("localhost"===window.location.hostname?window.location.origin:"https://neighborhoods.truesouthcoastalhomes.com")+"?marker="+e+n+'" target="_blank" class="flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors" title="Open '+t.name+' in Neighborhood Finder">Neighborhood Finder&trade; <svg style="display:inline;width:1.1em;height:1.1em;vertical-align:middle;margin-left:2px" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg></a>'}return I?'<a href="'+I+"\" target=\"_blank\" class=\"flex-1 text-center bg-brand-500 dark:bg-brand-dark hover:bg-brand-600 dark:hover:bg-brand-dark-hover text-white py-2.5 px-4 rounded-lg font-medium transition-colors\" onclick=\"event.stopPropagation(); if(typeof gtag!=='undefined')gtag('event','view_listings',{neighborhood_name:'"+t.name+"',listing_count:"+(r.listingCount||0)+",property_type:'"+t.propertyType+'\'});" title="View all '+t.name+" "+t.propertyType+' for sale">Matching Listings</a>':'<button class="flex-1 bg-neutral-300 dark:bg-dark-bg-elevated-2 text-neutral-500 dark:text-dark-text-secondary py-2.5 px-4 rounded-lg font-medium opacity-50 cursor-not-allowed" disabled title="MLS listings coming soon for '+t.name+'">Coming Soon!</button>'})()}\n                        ${S?'\n                        <button id="nav-next" onclick="window.navigateNeighborhood(1)" class="p-2 rounded-full border border-neutral-300 dark:border-dark-border hover:bg-brand-100 dark:hover:bg-brand-dark/20 text-neutral-600 dark:text-dark-text-secondary transition-colors flex-shrink-0 focus-ring" title="Next Community">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>\n                        </button>\n                        ':""}\n                    </div>\n                </div>\n            `;n.setContent(T),n.open({map:window.map,anchor:e}),google.maps.event.addListenerOnce(n,"domready",()=>{const e=document.querySelector(".amenities-scroll");e&&e.scrollHeight>e.clientHeight+4&&e.classList.add("has-overflow")}),n===window.infoWindow&&(google.maps.event.clearListeners(window.infoWindow,"closeclick"),window.infoWindow.addListener("closeclick",()=>{window.activeMarker&&window.activeMarker.content&&(window.activeMarker.content.innerHTML=s(window.activeMarker.markerColor,!1)),window.activeMarker=null}))}window.activeMarker=null,window.areaMarkers=new Map,window.showAreaMarker=function(e){google.maps.event.addListenerOnce(window.map,"idle",()=>{const t=e.position,n=window.createAreaMarkerData(e);n.position=t;const o=document.createElement("div");o.className="marker-pin area-marker",o.innerHTML=s("#4c8f96",!0),o.style.cursor="pointer",o.style.zIndex="1000";const i=new google.maps.marker.AdvancedMarkerElement({map:window.map,position:t,content:o,title:n.name+" (Area)",zIndex:1e3});i.markerColor="#4c8f96",i.addListener("click",()=>{l(i,n,window.infoWindow),window.activeMarker=i}),window.markers.push({marker:i,neighborhood:n}),window.areaMarkers.set(e.slug,i),l(i,n,window.infoWindow),window.activeMarker=i,setTimeout(()=>{requestAnimationFrame(()=>{r(new google.maps.LatLng(t),0,!1)})},100),setTimeout(()=>{window.logCenteringDiagnostics&&window.logCenteringDiagnostics(t)},500)})},window.hideAreaMarker=function(e){const t=window.areaMarkers.get(e);t&&(t.map=null,window.areaMarkers.delete(e),window.markers=window.markers.filter(e=>e.marker!==t),window.activeMarker===t&&(window.infoWindow?.close(),window.activeMarker=null))},window.addMarkers=function(){if(!window.map)return;(window.markers||[]).forEach(e=>e.marker.setMap(null)),window.markers=[];const e=window.filteredNeighborhoods||[];window.formatPrice;let t=null;e.forEach(e=>{if(e.isAreaMarker){const n="#4c8f96",o=document.createElement("div");o.className="marker-pin area-marker",o.innerHTML=s(n,!0),o.style.cursor="pointer",o.style.zIndex="1000";const i=new google.maps.marker.AdvancedMarkerElement({map:window.map,position:e.position,content:o,title:e.name+" (Area)",zIndex:1e3});return i.markerColor=n,i.addListener("click",()=>{c(i,e,window.infoWindow,!0),window.activeMarker=i}),window.markers.push({marker:i,neighborhood:e}),void(t={marker:i,neighborhood:e})}const n=e.urlSlug&&""!==e.urlSlug,o=e.mlsSubdivisions&&e.mlsSubdivisions.length>0||e.name&&""!==e.name,i=n?"#4c8f96":o?"#4a5462":"#9ca3af",r=document.createElement("div");r.className="marker-pin",r.innerHTML=s(i,!1),r.style.cursor="pointer";const a=new google.maps.marker.AdvancedMarkerElement({map:window.map,position:e.position,content:r,title:e.name});a.markerColor=i,a.addListener("click",()=>{!function(e,t,n){const o=e.markerColor;window.activeMarker===e?window.infoWindow&&window.infoWindow.getMap()?(window.infoWindow.close(),e.content.innerHTML=s(o,!1),window.activeMarker=null):(n(),e.content.innerHTML=s(o,!0)):(window.activeMarker&&window.activeMarker.content&&(window.activeMarker.content.innerHTML=s(window.activeMarker.markerColor,!1)),n(),e.content.innerHTML=s(o,!0),window.activeMarker=e)}(a,0,()=>{c(a,e,window.infoWindow,!0)})}),r.addEventListener("mouseenter",()=>{window.activeMarker!==a&&c(a,e,window.hoverInfoWindow,!1)}),r.addEventListener("mouseleave",()=>{window.hoverInfoWindow&&window.hoverInfoWindow.close()}),window.markers.push({marker:a,neighborhood:e})}),!t||window.skipAreaAnimation||window.isSingleMode||setTimeout(()=>{window.smoothFlyTo&&t.neighborhood.position&&window.smoothFlyTo(t.neighborhood.position,13),setTimeout(()=>{l(t.marker,t.neighborhood,window.infoWindow),window.activeMarker=t.marker,setTimeout(()=>{requestAnimationFrame(()=>{r(new google.maps.LatLng(t.neighborhood.position),0,!1)})},100)},200)},300)},"undefined"!=typeof google&&google.maps&&function(){const t=document.getElementById("map");if(!t)return;t.innerHTML="";const n=e(),a="single"===n.get("mode"),d=n.get("neighborhood")||n.get("marker");window.isSingleMode=a;let m={lat:30.32,lng:-86.05},w=11,g=null;const u=n.get("area");if(a&&d){const e=window.NEIGHBORHOOD_POSITIONS?.[d];if(e)w=parseInt(n.get("zoom"))||13,m=e,g=e,console.log("Single mode: using NEIGHBORHOOD_POSITIONS for",d);else if(window.neighborhoods){const e=window.neighborhoods.find(e=>window.toSlug&&window.toSlug(e.name)===d);e&&e.position&&(w=parseInt(n.get("zoom"))||13,m=e.position,g=e.position)}if(!g){const e=window.AREA_POSITIONS?.[d];e&&(w=parseInt(n.get("zoom"))||13,m=e,g=e,window.singleModeIsArea=!0,console.log("Single mode: using AREA_POSITIONS for",d))}}else if(a&&u){const e=window.AREA_POSITIONS?.[u];if(e)w=parseInt(n.get("zoom"))||13,m=e,g=e,window.singleModeIsArea=!0,console.log("Single mode: using AREA_POSITIONS for",u);else{const e=window.areaPresets?.presets?.find(e=>e.slug===u);e&&e.position&&(w=parseInt(n.get("zoom"))||13,m=e.position,g=e.position,window.singleModeIsArea=!0)}}let p=m;if(window.singleModeOffsetApplied=!1,window.singleModeTarget=g,a&&g){const e=document.getElementById("single-mode-overlay");e&&(e.style.display="flex",e.style.opacity="1"),p=m,console.log("Single mode: starting at TRUE center (no pre-offset), overlay shown"),setTimeout(()=>{o||(console.warn("Single mode: fallback timeout - fading overlay"),i(),o=!0)},5e3)}function h(){const e=document.querySelector(".gm-style-iw-chr");e&&e.remove()}window.map=new google.maps.Map(t,{zoom:w,center:p,mapId:"92b2f4ea8b2fce54a50ed2e9",mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!0,fullscreenControl:!0,zoomControl:!0,clickableIcons:!1}),window.infoWindow=new google.maps.InfoWindow({maxWidth:320,disableAutoPan:!0}),window.hoverInfoWindow=new google.maps.InfoWindow({maxWidth:320,disableAutoPan:!0}),window.infoWindow.addListener("domready",h),window.hoverInfoWindow.addListener("domready",h),["32541","32459","32550","32461","32413"].forEach(e=>{fetch(`./neighborhoods/jsons/${e}.geojson`).then(e=>e.json()).catch(()=>{})}),window.tryInitializeMarkers=function(){if(window.markersInitialized)return;const t=window.neighborhoods||[];if(!t.length||!window.map||!window.addMarkers)return;window.markersInitialized=!0;const n=e(),o="single"===n.get("mode"),i=n.get("neighborhood")||n.get("marker"),a=n.get("area");if(o){let e=null;if(i&&!a&&t.length>0){const n=t.filter(e=>window.toSlug(e.name)===i);n.length>0&&(e=n.find(e=>"Homes"===e.propertyType)||n[0],window.neighborhoods=[e],window.filteredNeighborhoods=[e],console.log("Single mode: neighborhood",e.name))}else if(a){const t=window.areaPresets?.presets?.find(e=>e.slug===a);t&&(e=window.createAreaMarkerData(t),window.filteredNeighborhoods=[e],console.log("Single mode: area",t.name))}}window.filteredNeighborhoods&&window.filteredNeighborhoods.length||(window.filteredNeighborhoods=[...t]),window.addMarkers(),console.log("Map initialized with",window.filteredNeighborhoods.length,"neighborhoods"),function(){if(o&&(a||i))return void setTimeout(()=>{let e=0;const t=()=>{e++,function(){if(!window.markers||0===window.markers.length)return!1;const e=window.markers[0];return!!(e&&e.marker&&e.neighborhood)&&(console.log("Single mode: opening",e.neighborhood.name),e.neighborhood.isAreaMarker?l(e.marker,e.neighborhood,window.infoWindow):c(e.marker,e.neighborhood,window.infoWindow,!0),google.maps.event.addListenerOnce(window.infoWindow,"domready",()=>{requestAnimationFrame(()=>{const t=e.neighborhood?.position||e.marker?.position||e.marker?.getPosition&&e.marker.getPosition();t&&r(t instanceof google.maps.LatLng?t:new google.maps.LatLng(t),0,!0)})}),e.marker.content.innerHTML=s(e.marker.markerColor,!0),window.activeMarker=e.marker,!0)}()||(e<30?setTimeout(t,100):console.warn("Single mode: marker not found after 3 seconds"))};t()},300);const e=n.get("marker");if(window.fitBoundsToNeighborhoods(),e){const o=window.areaPresets?.presets?.find(t=>t.slug===e);if(o)google.maps.event.addListenerOnce(window.map,"tilesloaded",()=>{setTimeout(()=>{const e=window.findAreaButton(o);e&&e.click()},400)});else{const o=n.get("propertyType")||"Homes",i=t.filter(t=>window.toSlug(t.name)===e);if(i.length>0){const e=i.find(e=>e.propertyType===o)||i[0];google.maps.event.addListenerOnce(window.map,"tilesloaded",()=>{setTimeout(()=>{const t=(window.markers||[]).find(t=>t.neighborhood.name===e.name&&t.neighborhood.propertyType===e.propertyType);t&&(window.smoothFlyTo(e.position),setTimeout(()=>{c(t.marker,e,window.infoWindow,!0),window.activeMarker=t.marker,t.marker.content.innerHTML=s(t.marker.markerColor,!0),setTimeout(()=>{requestAnimationFrame(()=>{r(new google.maps.LatLng(e.position),0,!1)})},100)},800))},400)})}}}}()},window.tryInitializeMarkers(),window.map.addListener("idle",()=>{window.map&&console.log("Zoom:",window.map.getZoom().toFixed(2))}),window.map.addListener("click",()=>{window.infoWindow&&window.infoWindow.getMap()&&window.infoWindow.close(),window.hoverInfoWindow&&window.hoverInfoWindow.getMap()&&window.hoverInfoWindow.close(),window.activeMarker&&window.activeMarker.content&&(window.activeMarker.content.innerHTML=s(window.activeMarker.markerColor,!1),window.activeMarker=null)}),window.isSingleMode||window.map.addListener("center_changed",()=>{window.infoWindow&&window.infoWindow.getMap()&&window.activeMarker&&window.infoWindow.open({map:window.map,anchor:window.activeMarker})})}(),window.gm_authFailure=function(){const e=document.getElementById("map-placeholder");e&&(e.innerHTML='\n                    <div class="text-center">\n                        <svg class="w-16 h-16 mx-auto text-neutral-300 dark:text-neutral-600 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />\n                        </svg>\n                        <p class="text-neutral-500 dark:text-neutral-400 font-medium mb-2">Map requires local server</p>\n                        <p class="text-neutral-400 dark:text-neutral-500 text-sm mb-3">Google Maps API key is restricted to specific domains.</p>\n                        <div class="bg-neutral-200 dark:bg-neutral-800 rounded-lg p-3 text-left text-xs">\n                            <p class="text-neutral-600 dark:text-neutral-300 mb-1">To test with map, run:</p>\n                            <code class="text-brand-700 dark:text-brand-dark">cd NeighborhoodFinder && npx serve .</code>\n                            <p class="text-neutral-500 dark:text-neutral-400 mt-2">Then open: <span class="text-brand-700 dark:text-brand-dark">http://localhost:3000/tests/drawer-prototype.html</span></p>\n                        </div>\n                    </div>\n                '),console.warn("Google Maps API auth failed - likely running from file:// URL")},setTimeout(()=>{if(!window.map){const e=document.getElementById("map-placeholder");e&&e.querySelector("p").textContent.includes("Loading")&&window.gm_authFailure()}},5e3);